<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <script src="/live2d-widget/live2d-widget-resource/jquery.min.js"></script>
  <link rel="stylesheet" href="/live2d-widget/live2d-widget-resource/font-awesome.min.css"/>
  <script src="/live2d-widget/autoload.js"></script>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<script data-ad-client="ca-pub-9657591565519636" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="kubernetes," />










<meta name="description" content="前言前段时间正在学习 kubernetes， 一般在刚开始学习的时候，都会先本地安装一下，然后逐渐学习。 而安装的话，也分三个过程，由简到难:  本地单机安装 – Minikube 集群安装    – Kubeadm – 请看 CentOS7 手动安装 Kubeadm 集群环境 二进制包安装 – 请看 CentOS7 使用二进制包安装 kubernetes 集群环境  本文主要讲本地单机安装 Mi">
<meta name="keywords" content="kubernetes">
<meta property="og:type" content="article">
<meta property="og:title" content="CentOS7 Minikube - Kubernetes 单机安装">
<meta property="og:url" content="http://kebingzao.com/2020/11/06/k8s-install-minikube/index.html">
<meta property="og:site_name" content="Zach Ke&#39;s Notes">
<meta property="og:description" content="前言前段时间正在学习 kubernetes， 一般在刚开始学习的时候，都会先本地安装一下，然后逐渐学习。 而安装的话，也分三个过程，由简到难:  本地单机安装 – Minikube 集群安装    – Kubeadm – 请看 CentOS7 手动安装 Kubeadm 集群环境 二进制包安装 – 请看 CentOS7 使用二进制包安装 kubernetes 集群环境  本文主要讲本地单机安装 Mi">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://kebingzao.com/2020/11/06/k8s-install-minikube/1.png">
<meta property="og:updated_time" content="2020-11-12T13:34:58.940Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CentOS7 Minikube - Kubernetes 单机安装">
<meta name="twitter:description" content="前言前段时间正在学习 kubernetes， 一般在刚开始学习的时候，都会先本地安装一下，然后逐渐学习。 而安装的话，也分三个过程，由简到难:  本地单机安装 – Minikube 集群安装    – Kubeadm – 请看 CentOS7 手动安装 Kubeadm 集群环境 二进制包安装 – 请看 CentOS7 使用二进制包安装 kubernetes 集群环境  本文主要讲本地单机安装 Mi">
<meta name="twitter:image" content="http://kebingzao.com/2020/11/06/k8s-install-minikube/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'KGVI6VPIBI',
      apiKey: '41c2ccc830ca183768a6bf1e50a03f44',
      indexName: 'test_blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://kebingzao.com/2020/11/06/k8s-install-minikube/"/>





  <title>CentOS7 Minikube - Kubernetes 单机安装 | Zach Ke's Notes</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <a href="https://github.com/kebingzao" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zach Ke's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Quick notes</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kebingzao.com/2020/11/06/k8s-install-minikube/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zach Ke">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zach Ke's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">CentOS7 Minikube - Kubernetes 单机安装</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-11-06T15:31:32+08:00">
                2020-11-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kubernetes/" itemprop="url" rel="index">
                    <span itemprop="name">kubernetes</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/11/06/k8s-install-minikube/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2020/11/06/k8s-install-minikube/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/11/06/k8s-install-minikube/" class="leancloud_visitors" data-flag-title="CentOS7 Minikube - Kubernetes 单机安装">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前段时间正在学习 kubernetes， 一般在刚开始学习的时候，都会先本地安装一下，然后逐渐学习。 而安装的话，也分三个过程，由简到难:</p>
<ol>
<li>本地单机安装 – Minikube</li>
<li>集群安装    – Kubeadm – 请看 <a href="/2020/11/06/k8s-install-kubeadm/" title="CentOS7 手动安装 Kubeadm 集群环境">CentOS7 手动安装 Kubeadm 集群环境</a></li>
<li>二进制包安装 – 请看 <a href="/2020/11/09/k8s-install-binary/" title="CentOS7 使用二进制包安装 kubernetes 集群环境">CentOS7 使用二进制包安装 kubernetes 集群环境</a></li>
</ol>
<p>本文主要讲本地单机安装 Minikube 的安装过程和简单的使用过程。</p>
<h2 id="本机环境"><a href="#本机环境" class="headerlink" title="本机环境"></a>本机环境</h2><p>线上关于这种的安装教程其实很多，但是因为 kubernetes 的快速迭代，很多早期的安装教程，现在再照着方式再安装，其实很多时候就安装不了，所以在安装之前要先把一些环境先说明一下。</p>
<p>本机环境:</p>
<table>
<thead>
<tr>
<th>环境参数</th>
<th>值</th>
</tr>
</thead>
<tbody>
<tr>
<td>系统</td>
<td>CentOS 7</td>
</tr>
<tr>
<td>CPU</td>
<td>2 核</td>
</tr>
<tr>
<td>内存</td>
<td>4 G</td>
</tr>
<tr>
<td>minikube 版本</td>
<td>v1.13.1</td>
</tr>
<tr>
<td>kubectl 版本</td>
<td>v1.19.2</td>
</tr>
<tr>
<td>docker 版本</td>
<td>v1.13.1</td>
</tr>
<tr>
<td>能否科学上网</td>
<td>能 (腾讯云位于美西的机器)</td>
</tr>
</tbody>
</table>
<p>几个细节:</p>
<ol>
<li>因为我的环境可以科学上网，所以 kubectl 可以直接下载， 如果不能的话，那么就要换成 阿里云的 国内镜像也行的。</li>
<li>minikube 只能用于学习 kubernetes 用， 只能单机， 不能用于生产环境。<a id="more"></a>
</li>
</ol>
<h2 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h2><p>为了更直观的展示实际安装过程，我这边直接将 shell 执行的操作贴出来(可能会比较丑)。</p>
<h3 id="1-创建一个用户"><a href="#1-创建一个用户" class="headerlink" title="1. 创建一个用户"></a>1. 创建一个用户</h3><p>因为不能用 root 来启动 minikube， 所以这边额外再创建一个账号角色: zach ,为了方便，将其设置为不需要密码， 后面就切换成这个账号来安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-64-15-centos ~]# useradd -m -s /bin/bash zach</span><br><span class="line">[root@VM-64-15-centos ~]# vim /etc/sudoers</span><br><span class="line">[root@VM-64-15-centos ~]# cat /etc/sudoers</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">root    ALL=(ALL)     ALL</span><br><span class="line">zach    ALL=(ALL)       NOPASSWD:ALL</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<h3 id="2-安装-docker"><a href="#2-安装-docker" class="headerlink" title="2. 安装 docker"></a>2. 安装 docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-64-15-centos ~]# su zach</span><br><span class="line">[zach@VM-64-15-centos root]$ sudo yum update</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">Determining fastest mirrors</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[zach@VM-64-15-centos root]$ sudo yum -y install docker</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line"></span><br><span class="line">[zach@VM-64-15-centos root]$ sudo systemctl start docker</span><br><span class="line"></span><br><span class="line">[zach@VM-64-15-centos root]$ sudo systemctl enable docker</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[zach@VM-64-15-centos root]$ sudo docker version</span><br><span class="line">Client:</span><br><span class="line">Version:         1.13.1</span><br><span class="line">API version:     1.26</span><br><span class="line">Package version: docker-1.13.1-162.git64e9980.el7.centos.x86_64</span><br><span class="line">Go version:      go1.10.3</span><br><span class="line">Git commit:      64e9980/1.13.1</span><br><span class="line">Built:           Wed Jul  1 14:56:42 2020</span><br><span class="line">OS/Arch:         linux/amd64</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line">Version:         1.13.1</span><br><span class="line">API version:     1.26 (minimum version 1.12)</span><br><span class="line">Package version: docker-1.13.1-162.git64e9980.el7.centos.x86_64</span><br><span class="line">Go version:      go1.10.3</span><br><span class="line">Git commit:      64e9980/1.13.1</span><br><span class="line">Built:           Wed Jul  1 14:56:42 2020</span><br><span class="line">OS/Arch:         linux/amd64</span><br><span class="line">Experimental:    false</span><br></pre></td></tr></table></figure>
<p>这样子 docker 就安装好了</p>
<h3 id="3-添加docker组，将当前用户加入该组"><a href="#3-添加docker组，将当前用户加入该组" class="headerlink" title="3. 添加docker组，将当前用户加入该组"></a>3. 添加docker组，将当前用户加入该组</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ sudo groupadd docker</span><br><span class="line">[zach@VM-64-15-centos root]$ sudo usermod -aG docker $&#123;USER&#125;</span><br><span class="line">[zach@VM-64-15-centos root]$ sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
<p>记得重启 docker</p>
<h3 id="4-安装-kubectl"><a href="#4-安装-kubectl" class="headerlink" title="4. 安装 kubectl"></a>4. 安装 kubectl</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[zach@VM-64-15-centos root]$ sudo curl -LO &quot;https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl&quot;</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100 41.0M  100 41.0M    0     0  61.0M      0 --:--:-- --:--:-- --:--:-- 61.0M</span><br><span class="line">[zach@VM-64-15-centos root]$ sudo chmod +x ./kubectl</span><br><span class="line">[zach@VM-64-15-centos root]$ sudo mv ./kubectl /usr/local/bin/kubectl</span><br><span class="line">[zach@VM-64-15-centos root]$ kubectl version --client</span><br><span class="line">Client Version: version.Info&#123;Major:&quot;1&quot;, Minor:&quot;19&quot;, GitVersion:&quot;v1.19.2&quot;, GitCommit:&quot;f5743093fd1c663cb0cbc89748f730662345d44d&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2020-09-16T13:41:02Z&quot;, GoVersion:&quot;go1.15&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>这样就安装好了，还要进行一些授权操作。</p>
<h3 id="5-安装-minikube"><a href="#5-安装-minikube" class="headerlink" title="5. 安装 minikube"></a>5. 安装 minikube</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ sudo curl -Lo minikube https://github.com/kubernetes/minikube/releases/download/v1.13.1/minikube-linux-amd64 &amp;&amp; sudo chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100   644  100   644    0     0   3517      0 --:--:-- --:--:-- --:--:--  3538</span><br><span class="line">100 55.9M  100 55.9M    0     0  15.0M      0  0:00:03  0:00:03 --:--:-- 20.0M</span><br></pre></td></tr></table></figure>
<h3 id="6-启动"><a href="#6-启动" class="headerlink" title="6. 启动"></a>6. 启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ minikube start --driver=docker</span><br><span class="line">* minikube v1.13.1 on Centos 7.8.2003</span><br><span class="line">* Using the docker driver based on user configuration</span><br><span class="line">* Starting control plane node minikube in cluster minikube</span><br><span class="line">* Pulling base image ...</span><br><span class="line">* Downloading Kubernetes v1.19.2 preload ...</span><br><span class="line">    &gt; preloaded-images-k8s-v6-v1.19.2-docker-overlay2-amd64.tar.lz4: 486.36 MiB</span><br><span class="line">* Creating docker container (CPUs=2, Memory=3900MB) ...</span><br><span class="line">* Preparing Kubernetes v1.19.2 on Docker 19.03.8 ...</span><br><span class="line">* Verifying Kubernetes components...</span><br><span class="line">* Enabled addons: default-storageclass, storage-provisioner</span><br><span class="line">* Done! kubectl is now configured to use &quot;minikube&quot; by default</span><br></pre></td></tr></table></figure>
<p>这样就启动成功了。</p>
<h3 id="7-启动-dashboard-插件"><a href="#7-启动-dashboard-插件" class="headerlink" title="7. 启动 dashboard 插件"></a>7. 启动 dashboard 插件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ minikube dashboard</span><br><span class="line">* Enabling dashboard ...</span><br><span class="line">* Verifying dashboard health ...</span><br><span class="line">* Launching proxy ...</span><br><span class="line">* Verifying proxy health ...</span><br><span class="line">* Opening http://127.0.0.1:40356/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser...</span><br><span class="line">  - http://127.0.0.1:40356/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/</span><br></pre></td></tr></table></figure>
<p>启动成功了, 但是这个 dashboard 内网可以访问，但是外网访问不了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-64-15-centos ~]# curl http://127.0.0.1:40356/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/</span><br><span class="line">&lt;!--</span><br><span class="line">Copyright 2017 The Kubernetes Authors.</span><br><span class="line"></span><br><span class="line">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="line">you may not use this file except in compliance with the License.</span><br><span class="line">You may obtain a copy of the License at</span><br><span class="line"></span><br><span class="line">    http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line"></span><br><span class="line">Unless required by applicable law or agreed to in writing, software</span><br><span class="line">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="line">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line">See the License for the specific language governing permissions and</span><br><span class="line">limitations under the License.</span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>dashboard 给出了一个访问地址，可以看出这个地址和端口只是k8s的虚拟地址，只能本机访问。这个是因为 minikube 为自带的 dashboard 创建了默认的service ，并采用了 ClusterIP 的暴露策略，及只对集群内部提供了一个访问地址，集群外并不能直接访问，需要设置集群的代理地址，所以我们可以通过 kubectl proxy 添加集群对外暴露接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos ~]$ kubectl proxy --port=8088  --address=&apos;0.0.0.0&apos; --disable-filter=true</span><br><span class="line">W0925 18:26:52.231038   28549 proxy.go:167] Request filter disabled, your proxy is vulnerable to XSRF attacks, please be cautious</span><br><span class="line">Starting to serve on [::]:8088</span><br></pre></td></tr></table></figure></p>
<p>这边要注意一个细节，8088 端口因为对外暴露了，所以防火墙那一块肯定不能拦，最好直接关掉<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-64-15-centos ~]# systemctl stop firewalld</span><br></pre></td></tr></table></figure></p>
<p>对于云服务器来说，这还不够， 因为云服务器本身机器的防火墙就是关闭的，他是通过安全组来开放端口的，所以要在安全组那边将 8088 这个端口进行开放。</p>
<p>另一个细节就是这个指令还是得用这个用户 zach 来执行，不能用 root 角色，不然端口会失败, curl 的时候报这个错误:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[::1]:8080: connect: connection refused</span><br></pre></td></tr></table></figure></p>
<p>这样子外网 ip 就可以访问了:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-64-15-centos ~]# curl http://170.xx.xx.160:8088/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/</span><br><span class="line">&lt;!--</span><br><span class="line">Copyright 2017 The Kubernetes Authors.</span><br><span class="line"></span><br><span class="line">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="line">you may not use this file except in compliance with the License.</span><br><span class="line">You may obtain a copy of the License at</span><br></pre></td></tr></table></figure></p>
<p><img src="/2020/11/06/k8s-install-minikube/1.png" alt="1"></p>
<p>这样子整个 minikube 就安装好了， 这边还有一个细节， 上述的 dashboard 指令 和  proxy 指令都是在前台运行的， 一旦 shell 窗口关闭了， 程序也就退出了。  所以我们要改成后台运行， 使用 nohup 将 dashboard 和 proxy 都变成后台运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ nohup minikube dashboard</span><br><span class="line">nohup: ignoring input and appending output to ‘/home/zach/nohup.out’</span><br><span class="line"></span><br><span class="line">[zach@VM-64-15-centos root]$ nohup kubectl proxy --port=8088 --address=&apos;0.0.0.0&apos; --disable-filter=true</span><br><span class="line">nohup: ignoring input and appending output to ‘/home/zach/nohup.out’</span><br></pre></td></tr></table></figure></p>
<p>这样子就算 shell 窗口关闭了， 程序还是在后台跑。 log 会输出到该用户根目录下的 nohup.out 文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos ~]$ cat nohup.out</span><br><span class="line">* Verifying dashboard health ...</span><br><span class="line">* Launching proxy ...</span><br><span class="line">* Verifying proxy health ...</span><br><span class="line">* Opening http://127.0.0.1:39711/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser...</span><br><span class="line">  - http://127.0.0.1:39711/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/</span><br><span class="line">W1010 15:57:40.510753 3499626 proxy.go:167] Request filter disabled, your proxy is vulnerable to XSRF attacks, please be cautious</span><br><span class="line">Starting to serve on [::]:8088</span><br></pre></td></tr></table></figure></p>
<p>如果要关闭也很简单, 找到对应的进程， 然后强制删除即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -9  [进程id]</span><br></pre></td></tr></table></figure></p>
<p>这样子 minikube 就安装好了，接下来就简单操作一下。</p>
<h2 id="体验"><a href="#体验" class="headerlink" title="体验"></a>体验</h2><h3 id="1-查看组件状态"><a href="#1-查看组件状态" class="headerlink" title="1. 查看组件状态"></a>1. 查看组件状态</h3><p>首先装好之后，查看一下组件状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ kubectl get cs</span><br><span class="line">Warning: v1 ComponentStatus is deprecated in v1.19+</span><br><span class="line">NAME                 STATUS      MESSAGE                                                                                       ERROR</span><br><span class="line">controller-manager   Unhealthy   Get &quot;http://127.0.0.1:10252/healthz&quot;: dial tcp 127.0.0.1:10252: connect: connection refused   </span><br><span class="line">scheduler            Unhealthy   Get &quot;http://127.0.0.1:10251/healthz&quot;: dial tcp 127.0.0.1:10251: connect: connection refused   </span><br><span class="line">etcd-0               Healthy     &#123;&quot;health&quot;:&quot;true&quot;&#125;</span><br></pre></td></tr></table></figure></p>
<p>发现  control 和 scheduler 都不健康, 后面查了一下 <a href="https://github.com/kubernetes/kubernetes/issues/93472" target="_blank" rel="noopener">kubectl get cs showing unhealthy statuses for controller-manager and scheduler on v1.18.6 clean install</a>, 发现在 v1.19 的版本，这个 api 已经不用了，所以也不准了。事实上是只要 etcd 是 healthy 就可以了。 它有包含另外两个的安全检查。</p>
<h3 id="2-查看集群"><a href="#2-查看集群" class="headerlink" title="2. 查看集群"></a>2. 查看集群</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ kubectl get node</span><br><span class="line">NAME       STATUS   ROLES    AGE   VERSION</span><br><span class="line">minikube   Ready    master   27d   v1.19.2</span><br></pre></td></tr></table></figure>
<p>可以看到只有 minikube 一个点。 因为本来就是单点。</p>
<h3 id="3-部署一个-hello-world-看看"><a href="#3-部署一个-hello-world-看看" class="headerlink" title="3. 部署一个 hello world 看看"></a>3. 部署一个 hello world 看看</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ kubectl create deployment hello-node-5 --image=k8s.gcr.io/echoserver:1.4</span><br><span class="line">deployment.apps/hello-node-5 created</span><br></pre></td></tr></table></figure>
<p>这样子就创建好了，接下来将服务暴露到宿主机 (设置type 为 NodePort)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ kubectl expose deployment hello-node-5 --type=NodePort --port=8080</span><br><span class="line">service/hello-node-5 exposed</span><br></pre></td></tr></table></figure></p>
<p>这边有一个细节要注意，这个端口不能随便设置的，要设置成 8080 (kubectl 的端口)，不然就会导致服务起的时候，会连不上。</p>
<p>接下来查看服务:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ kubectl get services</span><br><span class="line">NAME           TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">hello-node-5   NodePort       10.101.214.191   &lt;none&gt;        8080:32225/TCP   10s</span><br><span class="line">kubernetes     ClusterIP      10.96.0.1        &lt;none&gt;        443/TCP          17h</span><br></pre></td></tr></table></figure></p>
<p>将服务启动起来:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ minikube service hello-node-5</span><br><span class="line">|-----------|--------------|-------------|-------------------------|</span><br><span class="line">| NAMESPACE |     NAME     | TARGET PORT |           URL           |</span><br><span class="line">|-----------|--------------|-------------|-------------------------|</span><br><span class="line">| default   | hello-node-5 |        8080 | http://172.17.0.3:32225 |</span><br><span class="line">|-----------|--------------|-------------|-------------------------|</span><br><span class="line">* Opening service default/hello-node-5 in default browser...</span><br><span class="line">  - http://172.17.0.3:32225</span><br></pre></td></tr></table></figure></p>
<p>这时候集群内访问一下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ curl http://172.17.0.3:32225</span><br><span class="line">CLIENT VALUES:</span><br><span class="line">client_address=172.18.0.1</span><br><span class="line">command=GET</span><br><span class="line">real path=/</span><br><span class="line">query=nil</span><br><span class="line">request_version=1.1</span><br><span class="line">request_uri=http://172.17.0.3:8080/</span><br><span class="line"></span><br><span class="line">SERVER VALUES:</span><br><span class="line">server_version=nginx: 1.10.0 - lua: 10001</span><br><span class="line"></span><br><span class="line">HEADERS RECEIVED:</span><br><span class="line">accept=*/*</span><br><span class="line">host=172.17.0.3:32225</span><br><span class="line">user-agent=curl/7.29.0</span><br><span class="line">BODY:</span><br><span class="line">-no body in request-</span><br></pre></td></tr></table></figure></p>
<p>是正常的。接下来将其端口映射，暴露到外网，使其可以在宿主机上访问<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ kubectl port-forward service/hello-node-5 8005:8080</span><br><span class="line">Forwarding from 127.0.0.1:8005 -&gt; 8080</span><br><span class="line">Forwarding from [::1]:8005 -&gt; 8080</span><br><span class="line">Handling connection for 8005</span><br></pre></td></tr></table></figure></p>
<p>这样子就可以正常在宿主机上访问这个服务了:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ curl 127.0.0.1:8005</span><br><span class="line">CLIENT VALUES:</span><br><span class="line">client_address=127.0.0.1</span><br><span class="line">command=GET</span><br><span class="line">real path=/</span><br><span class="line">query=nil</span><br><span class="line">request_version=1.1</span><br><span class="line">request_uri=http://127.0.0.1:8080/</span><br><span class="line"></span><br><span class="line">SERVER VALUES:</span><br><span class="line">server_version=nginx: 1.10.0 - lua: 10001</span><br><span class="line"></span><br><span class="line">HEADERS RECEIVED:</span><br><span class="line">accept=*/*</span><br><span class="line">host=127.0.0.1:8005</span><br><span class="line">user-agent=curl/7.29.0</span><br><span class="line">BODY:</span><br><span class="line">-no body in request-</span><br></pre></td></tr></table></figure></p>
<h3 id="4-查看对应-pod-容器的日志"><a href="#4-查看对应-pod-容器的日志" class="headerlink" title="4. 查看对应 pod 容器的日志"></a>4. 查看对应 pod 容器的日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ kubectl logs -f hello-node-5-b4bd86477-zvll5</span><br><span class="line">172.18.0.1 - - [10/Oct/2020:03:17:15 +0000] &quot;GET / HTTP/1.1&quot; 200 388 &quot;-&quot; &quot;curl/7.29.0&quot;</span><br><span class="line">127.0.0.1 - - [10/Oct/2020:03:19:17 +0000] &quot;GET / HTTP/1.1&quot; 200 384 &quot;-&quot; &quot;curl/7.29.0&quot;</span><br><span class="line">127.0.0.1 - - [10/Oct/2020:03:20:58 +0000] &quot;GET / HTTP/1.1&quot; 200 384 &quot;-&quot; &quot;curl/7.29.0&quot;</span><br></pre></td></tr></table></figure>
<h3 id="5-进入到-pods-容器中-复制文件到容器"><a href="#5-进入到-pods-容器中-复制文件到容器" class="headerlink" title="5. 进入到 pods 容器中/复制文件到容器"></a>5. 进入到 pods 容器中/复制文件到容器</h3><p>跟 docker 操作类似，我们可以也可以进入到 pod 中的容器:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ kubectl exec -it hello-node-5-b4bd86477-zvll5 -- bash</span><br><span class="line">root@hello-node-5-b4bd86477-zvll5:/# ls</span><br><span class="line">README.md  bin    boot  dev  etc    home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">root@hello-node-5-b4bd86477-zvll5:/# exit</span><br><span class="line">exit</span><br></pre></td></tr></table></figure></p>
<p>复制 pod 容器中的 档案 到宿主机<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ kubectl cp hello-node-5-b4bd86477-zvll5:/etc/nginx/nginx.conf ~/abc.txt</span><br><span class="line">tar: Removing leading `/&apos; from member names</span><br><span class="line">[zach@VM-64-15-centos root]$ cd</span><br><span class="line">[zach@VM-64-15-centos ~]$ ll</span><br><span class="line">total 4</span><br><span class="line">-rw-rw-r-- 1 zach zach 2119 Oct 10 14:12 abc.txt</span><br><span class="line">[zach@VM-64-15-centos ~]$ head abc.txt</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>也可以将文件复制到容器中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos ~]$ echo &apos;hello world&apos; &gt; tmp.txt</span><br><span class="line">[zach@VM-64-15-centos ~]$ cat tmp.txt</span><br><span class="line">hello world</span><br><span class="line">[zach@VM-64-15-centos ~]$ kubectl cp tmp.txt hello-node-5-b4bd86477-zvll5:/etc/tmp.txt</span><br><span class="line">[zach@VM-64-15-centos ~]$ kubectl exec -it hello-node-5-b4bd86477-zvll5 -- bash</span><br><span class="line">root@hello-node-5-b4bd86477-zvll5:/# cat /etc/tmp.txt</span><br><span class="line">hello world</span><br><span class="line">root@hello-node-5-b4bd86477-zvll5:/# exit</span><br><span class="line">exit</span><br></pre></td></tr></table></figure></p>
<h2 id="遇到的几个坑"><a href="#遇到的几个坑" class="headerlink" title="遇到的几个坑"></a>遇到的几个坑</h2><p>别看上面好像安装的顺风顺水，事实上不是这样子的，还是有遇到过一些问题的，只不过是解决完之后，为了让篇幅连贯，单独将遇到的问题合并起来讲。</p>
<h3 id="1-cpu-一定要至少-2-核才行"><a href="#1-cpu-一定要至少-2-核才行" class="headerlink" title="1. cpu 一定要至少 2 核才行"></a>1. cpu 一定要至少 2 核才行</h3><p>之前在安装的时候，如果 cpu 只有一个的话， <code>minikube start</code> 启动的时候会报这个错误：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stderr:</span><br><span class="line">docker: Error response from daemon: Range of CPUs is from 0.01 to 1.00, as there are only 1 CPUs available.</span><br><span class="line">See &apos;docker run --help&apos;.</span><br></pre></td></tr></table></figure></p>
<h3 id="2-不能用-root-用户来执行"><a href="#2-不能用-root-用户来执行" class="headerlink" title="2. 不能用 root 用户来执行"></a>2. 不能用 root 用户来执行</h3><p>之前在用 docker 当 driver 的时候，有报了这个错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_156_200_centos ~]# minikube start --driver=docker</span><br><span class="line">* minikube v1.10.0 on Centos 7.6.1810</span><br><span class="line">* Using the docker driver based on user configuration</span><br><span class="line">* The &quot;docker&quot; driver should not be used with root privileges.</span><br><span class="line">* If you are running minikube within a VM, consider using --driver=none:</span><br><span class="line">*   https://minikube.sigs.k8s.io/docs/reference/drivers/none/</span><br></pre></td></tr></table></figure></p>
<p>后面查了一下:  <a href="https://github.com/kubernetes/minikube/issues/7903" target="_blank" rel="noopener">https://github.com/kubernetes/minikube/issues/7903</a></p>
<p>原来是不能用 root 角色来启动， 所以我后面又创建了一个 普通角色 来执行。也就是说，这三个指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">minikube start --driver=docker</span><br><span class="line"></span><br><span class="line">minikube dashboard</span><br><span class="line"></span><br><span class="line">kubectl proxy --port=8088  --address=&apos;0.0.0.0&apos; --disable-filter=true</span><br></pre></td></tr></table></figure>
<p>都要用这个用户来运行才行。</p>
<h3 id="3-启动-minikube-报代理错误"><a href="#3-启动-minikube-报代理错误" class="headerlink" title="3. 启动 minikube 报代理错误"></a>3. 启动 minikube 报代理错误</h3><p>之前启动 minikube 的时候，有报了这个错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[zach@VM-64-15-centos root]$ minikube start --driver=docker</span><br><span class="line">...</span><br><span class="line">* Updating the running docker &quot;minikube&quot; container ...</span><br><span class="line">! This container is having trouble accessing https://k8s.gcr.io</span><br><span class="line">* To pull new external images, you may need to configure a proxy: https://minikube.sigs.k8s.io/docs/reference/networking/proxy/</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>这个错误会导致，部署 pod 的时候，会拉取 image 失败，但是神奇的是，这台机器上网是可以的。 后面将 minikube 删掉重启，就可以了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[zach@VM-64-15-centos root]$ sudo systemctl restart docker.service</span><br><span class="line">[zach@VM-64-15-centos root]$ minikube delete</span><br><span class="line">* Deleting &quot;minikube&quot; in docker ...</span><br><span class="line">* Deleting container &quot;minikube&quot; ...</span><br><span class="line">* Removing /home/zach/.minikube/machines/minikube ...</span><br><span class="line">* Removed all traces of the &quot;minikube&quot; cluster.</span><br><span class="line">[zach@VM-64-15-centos root]$ minikube start --driver=docker</span><br><span class="line">* minikube v1.13.1 on Centos 7.8.2003</span><br><span class="line">* Using the docker driver based on user configuration</span><br><span class="line">* Starting control plane node minikube in cluster minikube</span><br><span class="line">* Pulling base image ...</span><br><span class="line">* Creating docker container (CPUs=2, Memory=3900MB) ...</span><br><span class="line">* Preparing Kubernetes v1.19.2 on Docker 19.03.8 ...</span><br><span class="line">* Verifying Kubernetes components...</span><br><span class="line">* Enabled addons: default-storageclass, storage-provisioner</span><br><span class="line">* Done! kubectl is now configured to use &quot;minikube&quot; by default</span><br></pre></td></tr></table></figure></p>
<hr>
<p>参考资料:</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/141831571" target="_blank" rel="noopener">一遍过，Centos7下minikube安装k8s学习环境</a></li>
<li><a href="https://developer.aliyun.com/article/221687" target="_blank" rel="noopener">Minikube - Kubernetes本地实验环境</a></li>
<li><a href="https://www.jianshu.com/p/ef020fa8ca97" target="_blank" rel="noopener">minikube 运行 dashboard，并对外暴露访问地址</a></li>
<li><a href="https://stackoverflow.com/questions/47173463/how-to-access-local-kubernetes-minikube-dashboard-remotely" target="_blank" rel="noopener">how to access local kubernetes minikube dashboard remotely</a></li>
<li><a href="https://kubernetes.io/docs/tutorials/hello-minikube/" target="_blank" rel="noopener">Hello Minikube</a></li>
<li><a href="https://ithelp.ithome.com.tw/articles/10202575" target="_blank" rel="noopener">透過Minikube 創建本機 K8s環境</a></li>
<li><a href="https://minikube.sigs.k8s.io/docs/start/" target="_blank" rel="noopener">minikube start</a></li>
</ul>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Zach Ke
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://kebingzao.com/2020/11/06/k8s-install-minikube/" title="CentOS7 Minikube - Kubernetes 单机安装">http://kebingzao.com/2020/11/06/k8s-install-minikube/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/kubernetes/" rel="tag"># kubernetes</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/09/30/docsify-search/" rel="next" title="优化 docsify 的 search 搜索功能">
                <i class="fa fa-chevron-left"></i> 优化 docsify 的 search 搜索功能
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/11/06/k8s-use-pwk/" rel="prev" title="使用 play with kubernetes 搭建 5 个节点的集群">
                使用 play with kubernetes 搭建 5 个节点的集群 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="Zach Ke" />
            
              <p class="site-author-name" itemprop="name">Zach Ke</p>
              <p class="site-description motion-element" itemprop="description">做最咸的那一条</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">235</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">53</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/kebingzao" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#本机环境"><span class="nav-number">2.</span> <span class="nav-text">本机环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#开始安装"><span class="nav-number">3.</span> <span class="nav-text">开始安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-创建一个用户"><span class="nav-number">3.1.</span> <span class="nav-text">1. 创建一个用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-安装-docker"><span class="nav-number">3.2.</span> <span class="nav-text">2. 安装 docker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-添加docker组，将当前用户加入该组"><span class="nav-number">3.3.</span> <span class="nav-text">3. 添加docker组，将当前用户加入该组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-安装-kubectl"><span class="nav-number">3.4.</span> <span class="nav-text">4. 安装 kubectl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-安装-minikube"><span class="nav-number">3.5.</span> <span class="nav-text">5. 安装 minikube</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-启动"><span class="nav-number">3.6.</span> <span class="nav-text">6. 启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-启动-dashboard-插件"><span class="nav-number">3.7.</span> <span class="nav-text">7. 启动 dashboard 插件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#体验"><span class="nav-number">4.</span> <span class="nav-text">体验</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-查看组件状态"><span class="nav-number">4.1.</span> <span class="nav-text">1. 查看组件状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-查看集群"><span class="nav-number">4.2.</span> <span class="nav-text">2. 查看集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-部署一个-hello-world-看看"><span class="nav-number">4.3.</span> <span class="nav-text">3. 部署一个 hello world 看看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-查看对应-pod-容器的日志"><span class="nav-number">4.4.</span> <span class="nav-text">4. 查看对应 pod 容器的日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-进入到-pods-容器中-复制文件到容器"><span class="nav-number">4.5.</span> <span class="nav-text">5. 进入到 pods 容器中/复制文件到容器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#遇到的几个坑"><span class="nav-number">5.</span> <span class="nav-text">遇到的几个坑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-cpu-一定要至少-2-核才行"><span class="nav-number">5.1.</span> <span class="nav-text">1. cpu 一定要至少 2 核才行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-不能用-root-用户来执行"><span class="nav-number">5.2.</span> <span class="nav-text">2. 不能用 root 用户来执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-启动-minikube-报代理错误"><span class="nav-number">5.3.</span> <span class="nav-text">3. 启动 minikube 报代理错误</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zach Ke</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://zach-2.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://kebingzao.com/2020/11/06/k8s-install-minikube/';
          this.page.identifier = '2020/11/06/k8s-install-minikube/';
          this.page.title = 'CentOS7 Minikube - Kubernetes 单机安装';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://zach-2.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("HIV4XRdKJXB0eaFgtSjiVNaK-gzGzoHsz", "zN3v8grxW0Q8eXwNlEgXxWrF");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  



</body>
</html>
