<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <script src="/live2d-widget/live2d-widget-resource/jquery.min.js"></script>
  <link rel="stylesheet" href="/live2d-widget/live2d-widget-resource/font-awesome.min.css"/>
  <script src="/live2d-widget/autoload.js"></script>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />


















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="logan," />










<meta name="description" content="前言前段时间，业务要上线一个 web 的业务，他是使用 webrtc 的技术去远程控制手机的。 但是使用 webrtc 连接过程中， 会涉及到大量的信息交互， 比如接口交互， signal 交互， ice 交互， sdp 交互。 有时候出现连接失败的情况， 需要开发人员去排查到底卡在哪一个环节。 但是 web 不像其他客户端，可以让用户提供某个目录下的某一个日志文件。 他在浏览器跑的， 一般关掉浏">
<meta name="keywords" content="logan">
<meta property="og:type" content="article">
<meta property="og:title" content="使用 Logan 来做前端日志系统">
<meta property="og:url" content="http://kebingzao.com/2021/08/19/use-web-logan/index.html">
<meta property="og:site_name" content="Zach Ke&#39;s Notes">
<meta property="og:description" content="前言前段时间，业务要上线一个 web 的业务，他是使用 webrtc 的技术去远程控制手机的。 但是使用 webrtc 连接过程中， 会涉及到大量的信息交互， 比如接口交互， signal 交互， ice 交互， sdp 交互。 有时候出现连接失败的情况， 需要开发人员去排查到底卡在哪一个环节。 但是 web 不像其他客户端，可以让用户提供某个目录下的某一个日志文件。 他在浏览器跑的， 一般关掉浏">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://kebingzao.com/2021/08/19/use-web-logan/1.png">
<meta property="og:image" content="http://kebingzao.com/2021/08/19/use-web-logan/2.png">
<meta property="og:image" content="http://kebingzao.com/2021/08/19/use-web-logan/3.png">
<meta property="og:image" content="http://kebingzao.com/2021/08/19/use-web-logan/4.png">
<meta property="og:image" content="http://kebingzao.com/2021/08/19/use-web-logan/5.png">
<meta property="og:image" content="http://kebingzao.com/2021/08/19/use-web-logan/6.png">
<meta property="og:image" content="http://kebingzao.com/2021/08/19/use-web-logan/7.png">
<meta property="og:image" content="http://kebingzao.com/2021/08/19/use-web-logan/8.png">
<meta property="og:image" content="http://kebingzao.com/2021/08/19/use-web-logan/9.png">
<meta property="og:image" content="http://kebingzao.com/2021/08/19/use-web-logan/10.png">
<meta property="og:image" content="http://kebingzao.com/2021/08/19/use-web-logan/11.png">
<meta property="og:image" content="http://kebingzao.com/2021/08/19/use-web-logan/12.png">
<meta property="og:image" content="http://kebingzao.com/2021/08/19/use-web-logan/13.png">
<meta property="og:image" content="http://kebingzao.com/2021/08/19/use-web-logan/14.png">
<meta property="og:updated_time" content="2021-08-28T11:11:34.690Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用 Logan 来做前端日志系统">
<meta name="twitter:description" content="前言前段时间，业务要上线一个 web 的业务，他是使用 webrtc 的技术去远程控制手机的。 但是使用 webrtc 连接过程中， 会涉及到大量的信息交互， 比如接口交互， signal 交互， ice 交互， sdp 交互。 有时候出现连接失败的情况， 需要开发人员去排查到底卡在哪一个环节。 但是 web 不像其他客户端，可以让用户提供某个目录下的某一个日志文件。 他在浏览器跑的， 一般关掉浏">
<meta name="twitter:image" content="http://kebingzao.com/2021/08/19/use-web-logan/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'KGVI6VPIBI',
      apiKey: '41c2ccc830ca183768a6bf1e50a03f44',
      indexName: 'test_blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://kebingzao.com/2021/08/19/use-web-logan/"/>





  <title>使用 Logan 来做前端日志系统 | Zach Ke's Notes</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <a href="https://github.com/kebingzao" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zach Ke's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Quick notes</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kebingzao.com/2021/08/19/use-web-logan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zach Ke">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zach Ke's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">使用 Logan 来做前端日志系统</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-08-19T14:18:05+08:00">
                2021-08-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/实用工具集/" itemprop="url" rel="index">
                    <span itemprop="name">实用工具集</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/08/19/use-web-logan/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/08/19/use-web-logan/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2021/08/19/use-web-logan/" class="leancloud_visitors" data-flag-title="使用 Logan 来做前端日志系统">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前段时间，业务要上线一个 web 的业务，他是使用 webrtc 的技术去远程控制手机的。 但是使用 webrtc 连接过程中， 会涉及到大量的信息交互， 比如接口交互， signal 交互， ice 交互， sdp 交互。 有时候出现连接失败的情况， 需要开发人员去排查到底卡在哪一个环节。 但是 web 不像其他客户端，可以让用户提供某个目录下的某一个日志文件。 他在浏览器跑的， 一般关掉浏览器， log 也就没有了。 而且我们也不希望线上的产品，在浏览器的 console 控制台上输出一堆的 log， 显得很不专业。 而且也没有哪个用户会在运行的时候，打开 console 控制台的。</p>
<p>因为将这些连接失败的 log 上抛到服务端是必要的，虽然可以借助 indexDB 或者 localstorage 之类的 浏览器存储来暂时存放。 但是如果一整套都要自己做的话，真的太累了。 所以就萌生了直接找第三方开源解决方案的想法。 刚好有找到一个 美团点评开源的前端日志系统: Logan</p>
<h2 id="Logan"><a href="#Logan" class="headerlink" title="Logan"></a>Logan</h2><p>Logan 开源的是一整套日志体系，包括日志的收集存储，上报分析以及可视化展示。它提供了五个组件，包括端上日志收集存储 、iOS SDK、Android SDK、Web SDK，后端日志存储分析 Server，日志分析平台 LoganSite。并且提供了一个 Flutter 插件Flutter 插件。</p>
<p>相关资讯这边不再说，本文也不是科普文，而是实操文，具体资料可以看:</p>
<ul>
<li><a href="https://github.com/Meituan-Dianping/Logan/blob/master/README-zh.md" target="_blank" rel="noopener">Logan</a></li>
<li><a href="https://github.com/Meituan-Dianping/Logan/blob/master/Logan/WebSDK/README.ch.md" target="_blank" rel="noopener">Logan Web SDK</a></li>
<li><a href="https://tech.meituan.com/2020/01/09/meituan-logan.html" target="_blank" rel="noopener">美团开源 Logan Web：前端日志在 Web 端的实现</a></li>
</ul>
<a id="more"></a>
<p>废话少说，开始安装吧</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>一整套要全部安装成功，包含三部分</p>
<ol>
<li>Server 端</li>
<li>展示日志的 UI 端</li>
<li>前端调用的 sdk</li>
</ol>
<h3 id="部署-Server-端"><a href="#部署-Server-端" class="headerlink" title="部署 Server 端"></a>部署 Server 端</h3><p>接下来我们开始部署 Server 端，然后我们的服务器是 CentOS 7。</p>
<p>这个 Server 端虽然 github 项目上有源码，但是他其实是一个 java 程序，而且还是一个 maven 项目的 java 程序， 所以部署的话要装相关的 java 环境，包含:</p>
<ul>
<li>java</li>
<li>tomcat (server 部署)</li>
<li>maven (打成 war 包)</li>
</ul>
<p><img src="/2021/08/19/use-web-logan/1.png" alt=""></p>
<h4 id="安装-java"><a href="#安装-java" class="headerlink" title="安装 java"></a>安装 java</h4><p>因为我们的服务器上没有 java 环境，所以我们先安装 java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-13-centos ~]# java -version</span><br><span class="line">-bash: java: command not found</span><br><span class="line"></span><br><span class="line">[root@VM-0-13-centos ~]# yum install java</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[root@VM-0-13-centos ~]# java -version</span><br><span class="line">openjdk version &quot;1.8.0_302&quot;</span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_302-b08)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.302-b08, mixed mode)</span><br></pre></td></tr></table></figure></p>
<p>这样子就安装好了。</p>
<h4 id="安装-Tomcat"><a href="#安装-Tomcat" class="headerlink" title="安装 Tomcat"></a>安装 Tomcat</h4><p>因为之前也没有安装过 Tomcat， 所以这次也要装，可以参照: <a href="https://www.ionos.com/digitalguide/server/configuration/apache-tomcat-on-centos/" target="_blank" rel="noopener">apache tomcat on centos</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-13-centos ~]# yum install tomcat</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>这样子就装好了。 接下来启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-13-centos usr]# sudo systemctl start tomcat</span><br></pre></td></tr></table></figure></p>
<p>然后测试一下 <code>8080</code> 端口是否有启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-13-centos usr]# curl 127.0.0.1:8080</span><br></pre></td></tr></table></figure></p>
<p>虽然有启动，但是没有 web 页面响应， 这个是因为 我们这时候装的 Tomcat 只有一个服务， 并没有包含 webapp 和 admin 管理那一块的。 所以这一块也要另外安装才行</p>
<p>所以先停止<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-13-centos usr]# sudo systemctl stop tomcat</span><br></pre></td></tr></table></figure></p>
<p>然后安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-13-centos usr]# yum install tomcat-webapps tomcat-admin-webapps tomcat-docs-webapp tomcat-javadoc</span><br></pre></td></tr></table></figure></p>
<p>这时候 重新启动，就可以看到页面有返回了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-13-centos usr]# sudo systemctl start tomcat</span><br><span class="line">[root@VM-0-13-centos usr]# curl 127.0.0.1:8080</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Apache Tomcat/7.0.76&lt;/title&gt;</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure></p>
<p>然后在腾讯云安全组那边 对 <code>8080</code> 端口，进行开放，然后外网访问试试 </p>
<blockquote>
<p>因为后面要用 nginx 进行转发代理，所以 Tomcat 的 8080 端口其实不需要在外网开放, 本文这么做主要为了更直观的看到 Tomcat 部署的页面情况</p>
</blockquote>
<p><img src="/2021/08/19/use-web-logan/2.png" alt=""></p>
<p>这时候就可以看到了。</p>
<p>最后将 Tomcat 设置为 开机自启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-13-centos usr]# sudo systemctl enable tomcat</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/tomcat.service to /usr/lib/systemd/system/tomcat.service.</span><br></pre></td></tr></table></figure>
<h4 id="部署程序"><a href="#部署程序" class="headerlink" title="部署程序"></a>部署程序</h4><p>接下来我们将这个 Logan 的 server 项目 部署到 Tomcat 中</p>
<p>找到 webapps 目录下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-13-centos tomcat]# cd /var/lib/tomcat/webapps/</span><br><span class="line">[root@VM-0-13-centos webapps]# ll</span><br><span class="line">total 24</span><br><span class="line">drwxr-xr-x 14 root   root   4096 Aug 18 16:06 docs</span><br><span class="line">drwxr-xr-x  8 tomcat tomcat 4096 Aug 18 16:06 examples</span><br><span class="line">drwxr-xr-x  5 root   tomcat 4096 Aug 18 16:06 host-manager</span><br><span class="line">drwxr-xr-x  5 root   tomcat 4096 Aug 18 16:06 manager</span><br><span class="line">drwxr-xr-x  3 tomcat tomcat 4096 Aug 18 16:06 ROOT</span><br><span class="line">drwxr-xr-x  5 tomcat tomcat 4096 Aug 18 16:06 sample</span><br></pre></td></tr></table></figure></p>
<p>这个 webapps 目录下的 ROOT，其实就是站点根目录，也就是只要保留 ROOT 目录即可，其他都可以删掉 (事实上后面这个 webapps 会直接清空的)</p>
<p>接下来我们将 Server 的代码打成 war 包，就是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/Meituan-Dianping/Logan/tree/master/Logan/Server</span><br></pre></td></tr></table></figure></p>
<p>这个目录下的代码 (刚开始不需要改任何的代码， 先运行起来再说)</p>
<p><img src="/2021/08/19/use-web-logan/3.png" alt=""></p>
<h4 id="踩过的坑，不能用-jar-打-war-包"><a href="#踩过的坑，不能用-jar-打-war-包" class="headerlink" title="踩过的坑，不能用 jar 打 war 包"></a>踩过的坑，不能用 jar 打 war 包</h4><p>这边在那时候的实作中，有走了一个弯路，就是知道是要打成 war 包， 但是那时候不知道要用 maven 打， 而是直接用 jar 打, 而且因为 jar 命令不存在，还要装一个依赖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-13-centos ROOT]# yum install -y java-1.8.0-openjdk-devel</span><br></pre></td></tr></table></figure></p>
<p>然后这时候就可以用 jar 打 war 包了:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-13-centos ROOT]# jar -cvf ROOT.war ./*</span><br><span class="line">added manifest</span><br><span class="line">adding: pom.xml(in = 7781) (out= 1150)(deflated 85%)</span><br><span class="line">adding: README(in = 4471) (out= 1401)(deflated 68%)</span><br><span class="line">adding: Server.zip(in = 63860) (out= 47227)(deflated 26%)</span><br><span class="line">adding: src/(in = 0) (out= 0)(stored 0%)</span><br></pre></td></tr></table></figure></p>
<p>在代码目录下， 成功将 war 包打出来了， 并命名为 ROOT.war, 接下来就是将 Tomcat 的 webapps 目录清空掉，然后将 ROOT.war 放到 webapps 目录下，然后重启 Tomcat， 这时候 Tomcat 就会将 ROOT.war 解压成 ROOT 目录了。 当然结果是这样子是不行的， 直接 404 了</p>
<p><img src="/2021/08/19/use-web-logan/4.png" alt=""></p>
<h4 id="安装-maven，并且用-maven-打-war-包"><a href="#安装-maven，并且用-maven-打-war-包" class="headerlink" title="安装 maven，并且用 maven 打 war 包"></a>安装 maven，并且用 maven 打 war 包</h4><p>后面发现这个是一个 maven 项目，所以打 war 包，还得用 maven 来打。 所以还是得装 maven:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-13-centos ~]# mvn -v</span><br><span class="line">-bash: mvn: command not found</span><br><span class="line"></span><br><span class="line">[root@VM-0-13-centos local]# yum install maven</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[root@VM-0-13-centos local]# mvn -v</span><br><span class="line">Apache Maven 3.0.5 (Red Hat 3.0.5-17)</span><br><span class="line">Maven home: /usr/share/maven</span><br><span class="line">Java version: 1.8.0_302, vendor: Red Hat, Inc.</span><br><span class="line">Java home: /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.302.b08-0.el7_9.x86_64/jre</span><br><span class="line">Default locale: en_US, platform encoding: UTF-8</span><br><span class="line">OS name: &quot;linux&quot;, version: &quot;3.10.0-1160.31.1.el7.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;</span><br></pre></td></tr></table></figure></p>
<p>这样子就装好了， 接下来就是执行 <code>mvn package</code> 指令在代码目录下打包了 (第一次打的时候，会安装很多依赖，所以会稍微久一点):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-13-centos Server]# mvn package</span><br><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[WARNING]</span><br><span class="line">[WARNING] Some problems were encountered while building the effective model for com.meituan.logan:logan-web:war:1.0-SNAPSHOT</span><br><span class="line">...</span><br><span class="line">[INFO] Assembling webapp[logan-web] in [/root/Server/target/logan-web-beta-1.0-SNAPSHOT]</span><br><span class="line">[INFO] Processing war project</span><br><span class="line">[INFO] Webapp assembled in[76 msecs]</span><br><span class="line">[INFO] Building war: /root/Server/target/logan-web-beta-1.0-SNAPSHOT.war</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time: 3.657s</span><br><span class="line">[INFO] Finished at: Wed Aug 18 17:27:49 CST 2021</span><br><span class="line">[INFO] Final Memory: 19M/417M</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure></p>
<p>最后就可以得到 <code>/root/Server/target/logan-web-beta-1.0-SNAPSHOT.war</code> 这个 war 包了。</p>
<p>接下来还是一样，将 webapps 清空，然后将这个 war 拷贝到这个目录下，并且重命名为 ROOT.war, 然后重启 Tomcat:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-13-centos webapps]# rm -rf ./*</span><br><span class="line">[root@VM-0-13-centos webapps]# ll</span><br><span class="line">total 0 </span><br><span class="line"></span><br><span class="line">[root@VM-0-13-centos webapps]# cp /root/Server/target/logan-web-beta-1.0-SNAPSHOT.war ./ROOT.war</span><br><span class="line">[root@VM-0-13-centos webapps]# ll</span><br><span class="line">total 26028</span><br><span class="line">-rw-r--r-- 1 root root 26651559 Aug 18 17:31 ROOT.war</span><br><span class="line"></span><br><span class="line">[root@VM-0-13-centos webapps]# systemctl restart tomcat</span><br><span class="line"></span><br><span class="line">[root@VM-0-13-centos webapps]# ll</span><br><span class="line">total 26032</span><br><span class="line">drwxr-xr-x 4 tomcat tomcat     4096 Aug 18 17:31 ROOT</span><br><span class="line">-rw-r--r-- 1 root   root   26651559 Aug 18 17:31 ROOT.war</span><br><span class="line"></span><br><span class="line">[root@VM-0-13-centos ROOT]# ll</span><br><span class="line">total 12</span><br><span class="line">-rw-r--r-- 1 tomcat tomcat   16 Aug 16 15:37 index.jsp</span><br><span class="line">drwxr-xr-x 3 tomcat tomcat 4096 Aug 18 17:31 META-INF</span><br><span class="line">drwxr-xr-x 4 tomcat tomcat 4096 Aug 18 17:31 WEB-INF</span><br></pre></td></tr></table></figure></p>
<p>这时候就可以看到 <code>index.jsp</code> 页面了。访问一下，就可以看到生效了</p>
<p><img src="/2021/08/19/use-web-logan/5.png" alt=""></p>
<p>请求一个业务接口，发现也不会报错:</p>
<p><img src="/2021/08/19/use-web-logan/6.png" alt=""></p>
<h4 id="创建库表并且配置正确的数据库链接"><a href="#创建库表并且配置正确的数据库链接" class="headerlink" title="创建库表并且配置正确的数据库链接"></a>创建库表并且配置正确的数据库链接</h4><p>Server 部署没问题之后，接下来就是建表了， 直接按照教程，先把这 4 个表建起来:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/Meituan-Dianping/Logan/tree/master/Logan/Server</span><br></pre></td></tr></table></figure></p>
<p><img src="/2021/08/19/use-web-logan/7.png" alt=""></p>
<p>建完之后，要修改对应的连接串，这个就要改到这个 java 代码，在 <code>db.properties</code>:</p>
<p><img src="/2021/08/19/use-web-logan/8.png" alt=""></p>
<blockquote>
<p>因为改到业务代码了， 如果要应用的话，那么就得重新打 war 包，然后重新部署 Tomcat，并重启 Tomcat</p>
</blockquote>
<h4 id="设置-CORS-跨域"><a href="#设置-CORS-跨域" class="headerlink" title="设置 CORS 跨域"></a>设置 CORS 跨域</h4><p>因为这个服务是要给前端请求的， 所以会涉及到 跨域问题， 他本身在 java 代码中，就有这个 跨域的配置了:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Server\src\main\java\com\meituan\logan\web\filter\CORSFilter.java</span><br></pre></td></tr></table></figure></p>
<p>原先的代码是这样子的:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private final List&lt;String&gt; allowedOrigins = Arrays.asList(&quot;http://localhost:3000&quot;, &quot;http://localhost:5001&quot;);</span><br></pre></td></tr></table></figure></p>
<p>因为后面我们前后端都会有域名，而且域名是不一样的，所以这边就要改成我们前端的域名，当做跨域白名单处理:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private final List&lt;String&gt; allowedOrigins = Arrays.asList(&quot;https://test-logan.foo.com&quot;, &quot;https://logan.foo.com&quot;);</span><br></pre></td></tr></table></figure></p>
<p>这样子就可以了，但是还会有一个问题，加上我后面其他 foo.com 的子域名也要用这个服务呢，那不是又得添加一次白名单， 所以更好的方法，直接去判断 origin 字段是否含有 <code>foo.com</code> 就可以了。</p>
<p>原先代码是:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.setHeader(&quot;Access-Control-Allow-Origin&quot;, allowedOrigins.contains(origin) ? origin : &quot;&quot;);</span><br></pre></td></tr></table></figure></p>
<p>就是判断 origin 是否在白名单之类， 但是后面我们改成直接判断是否含有这个 <code>foo.com</code> 二级域名即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.setHeader(&quot;Access-Control-Allow-Origin&quot;, (origin== null||origin== &quot;&quot;) ? &quot;&quot; : (origin.contains(&quot;foo.com&quot;) ? origin : &quot;&quot;));</span><br></pre></td></tr></table></figure></p>
<p>这样子更好，只要是这个域名下的子域名，就都可以跨域。</p>
<blockquote>
<p>因为改到业务代码了， 如果要应用的话，那么就得重新打 war 包，然后重新部署 Tomcat，并重启 Tomcat</p>
</blockquote>
<h4 id="nginx-代理转发"><a href="#nginx-代理转发" class="headerlink" title="nginx 代理转发"></a>nginx 代理转发</h4><p>因为 Tomcat 默认是 8080 端口，不好看，最好还是默认的 80， 但是 80 在这台服务器上已经被 nginx 拿走了， 而且 Tomcat 服务如果要单独设置 域名 和 ssl 设置，又比较麻烦， 所以直接本机用 nginx 进行代理转发就行了。快捷方便， 所以转发代理的配置如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">upstream api_server &#123;</span><br><span class="line">		server 127.0.0.1:8080 fail_timeout=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	listen 443 ssl http2;</span><br><span class="line">	server_name test-logan-server.foo.com;</span><br><span class="line">	include ssl/ssl_foo.com.conf;</span><br><span class="line">  access_log /var/log/nginx/logan.foo.com.access.log main;</span><br><span class="line">	error_log /var/log/nginx/logan.foo.com.error.log warn;	</span><br><span class="line">	 </span><br><span class="line">	location / &#123;</span><br><span class="line">		proxy_pass  http://api_server;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/2021/08/19/use-web-logan/9.png" alt=""></p>
<p>这样子 Server 就部署好了。</p>
<h3 id="部署-LoganSite-端"><a href="#部署-LoganSite-端" class="headerlink" title="部署 LoganSite 端"></a>部署 LoganSite 端</h3><p>这个是前端的 日志展示页面， 其实是一个用 react 框架写的静态站点， 部署文档:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/Meituan-Dianping/Logan/blob/master/README-zh.md#logansite</span><br></pre></td></tr></table></figure></p>
<p>我们直接看部署到线上的方式，就是 将 <code>LoganSite/src/common/api.js</code> 中第四行改成 server 的地址即可:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//const BASE_URL = process.defineEnv.API_BASE_URL;</span><br><span class="line">const BASE_URL = &quot;https://test-logan-server.foo.com&quot;;</span><br></pre></td></tr></table></figure></p>
<p>这样子就可以直接打包了:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd $LOGAN_SITE</span><br><span class="line">$ npm install</span><br><span class="line">$ npm run build</span><br></pre></td></tr></table></figure></p>
<p><img src="/2021/08/19/use-web-logan/10.png" alt=""></p>
<p>然后将 build 的静态文件，拷贝到服务器上，用 nginx 部署即可, 配上域名 和 ssl<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	listen 443 ssl http2;</span><br><span class="line">	server_name test-logan.foo.com;</span><br><span class="line">	</span><br><span class="line">	include ssl/ssl_foo.com.conf;</span><br><span class="line">  access_log /var/log/nginx/logan.foo.com.access.log main;</span><br><span class="line">	error_log /var/log/nginx/logan.foo.com.error.log warn;	</span><br><span class="line">	 </span><br><span class="line"> 	root /usr/local/src/Logan/Logan/LoganSite/build;</span><br><span class="line">	index index.html index.htm index.php;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		try_files $uri $uri/ /index.html;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样子就好了</p>
<p><img src="/2021/08/19/use-web-logan/11.png" alt=""></p>
<h3 id="接入-WEB-SDK-测试"><a href="#接入-WEB-SDK-测试" class="headerlink" title="接入 WEB SDK 测试"></a>接入 WEB SDK 测试</h3><p>Server 和 LoganSite 都部署好了，接下来就是接入 WEB SDK 看下是否有抛送， 这个也是直接有 demo 的，在:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/Meituan-Dianping/Logan/tree/master/Example/Logan-WebSDK</span><br></pre></td></tr></table></figure></p>
<p>直接跑这个项目就行了，不过要改一下 <code>src/test.js</code> 中抛送的这个 url <code>reportUrl</code>， 改成我们 Server 的接口:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">var Logan = require('logan-web');</span><br><span class="line">Logan.initConfig(&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">function timeFormat2Day(date) &#123;</span><br><span class="line">    var Y = date.getFullYear();</span><br><span class="line">    var M = date.getMonth() + 1;</span><br><span class="line">    var D = date.getDate();</span><br><span class="line">    return Y + '-' + (M &lt; 10 ? '0' + M : M) + '-' + (D &lt; 10 ? '0' + D : D);</span><br><span class="line">&#125;</span><br><span class="line">document.getElementById('log').onclick = log;</span><br><span class="line">document.getElementById('logWithEncryption').onclick = logWithEncryption;</span><br><span class="line">document.getElementById('report').onclick = report;</span><br><span class="line"></span><br><span class="line">function log() &#123;</span><br><span class="line">    Logan.log('Hello World!132456', 1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function logWithEncryption() &#123;</span><br><span class="line">    Logan.logWithEncryption('Hello World!', 2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function report() &#123;</span><br><span class="line">    var now = new Date();</span><br><span class="line">    var sevenDaysAgo = new Date(+now - 6 * 24 * 3600 * 1000);</span><br><span class="line">    Logan.report(&#123;</span><br><span class="line">        reportUrl: 'https://test-logan-server.foo.com/logan/web/upload.json',</span><br><span class="line">        deviceId: 'test-logan-web-2',</span><br><span class="line">        fromDayString: timeFormat2Day(sevenDaysAgo),</span><br><span class="line">        toDayString: timeFormat2Day(now),</span><br><span class="line">        webSource: 'browser',</span><br><span class="line">        environment: navigator.userAgent,</span><br><span class="line">        customInfo: JSON.stringify(&#123; userId: 123456789, biz: 'Live Better' &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其他都不用改，然后重新打包，安装依赖之后，执行:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run demo</span><br></pre></td></tr></table></figure></p>
<p>这时候就会用 webpack 打包了:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;demo&quot;: &quot;rm -rf demo/js &amp;&amp; webpack&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>不过如果是 windows 的话，那么是不支持 <code>rm</code> 指令的，可以直接去掉 rm 指令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;demo&quot;: &quot;webpack&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>这样子就可以了，不过为了防止打包的旧文件一直存在，打包之前最好将 demo 文件的 js 目录删除。 打完包之后， 我们还需要创建一个 webserver， 可以用 npm 装一个简单的 <a href="https://www.npmjs.com/package/http-server" target="_blank" rel="noopener">http-server</a>, 然后直接在 demo 目录下启动即可:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">F:\foo_code\github\Logan\Example\Logan-WebSDK\demo&gt;http-server ./ -p 8001</span><br><span class="line">Starting up http-server, serving ./</span><br><span class="line">Available on:</span><br><span class="line">  http://192.168.40.51:8001</span><br><span class="line">  http://127.0.0.1:8001</span><br><span class="line">Hit CTRL-C to stop the server</span><br></pre></td></tr></table></figure></p>
<p>这时候就可以访问 test.html 文件了，不过要注意，因为有跨域限制，所以要本地 host 一个 <code>*.foo.com</code> 的域名，才能正常请求:</p>
<p><img src="/2021/08/19/use-web-logan/12.png" alt=""></p>
<p>点击 Log 按钮，就是记录信息到 indexDB， 然后 点击 report 按钮，就是抛送到服务端</p>
<p><img src="/2021/08/19/use-web-logan/13.png" alt=""></p>
<p>我们可以在 indexDB 那边看到数据，这时候 LoganSite 也有数据了。</p>
<p><img src="/2021/08/19/use-web-logan/14.png" alt=""></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>整个框架算是搭起来了， 接下来就看好不好用，以及怎么用了， 因为我看了一下，他有任务编号，也有日志编号。 所以用的话，也不能无脑用，还是有技巧的。</p>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Zach Ke
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://kebingzao.com/2021/08/19/use-web-logan/" title="使用 Logan 来做前端日志系统">http://kebingzao.com/2021/08/19/use-web-logan/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/logan/" rel="tag"># logan</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/08/11/webrtc-install-kurento/" rel="next" title="云服务器裸机安装 Kurento 并应用">
                <i class="fa fa-chevron-left"></i> 云服务器裸机安装 Kurento 并应用
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/08/26/qiniu-s3-verify-md5/" rel="prev" title="在进行七牛或者S3文件上传的时候，怎么保证上传文件的完整性">
                在进行七牛或者S3文件上传的时候，怎么保证上传文件的完整性 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="Zach Ke" />
            
              <p class="site-author-name" itemprop="name">Zach Ke</p>
              <p class="site-description motion-element" itemprop="description">做最咸的那一条</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">291</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">72</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/kebingzao" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Logan"><span class="nav-number">2.</span> <span class="nav-text">Logan</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装"><span class="nav-number">3.</span> <span class="nav-text">安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#部署-Server-端"><span class="nav-number">3.1.</span> <span class="nav-text">部署 Server 端</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装-java"><span class="nav-number">3.1.1.</span> <span class="nav-text">安装 java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装-Tomcat"><span class="nav-number">3.1.2.</span> <span class="nav-text">安装 Tomcat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#部署程序"><span class="nav-number">3.1.3.</span> <span class="nav-text">部署程序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#踩过的坑，不能用-jar-打-war-包"><span class="nav-number">3.1.4.</span> <span class="nav-text">踩过的坑，不能用 jar 打 war 包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装-maven，并且用-maven-打-war-包"><span class="nav-number">3.1.5.</span> <span class="nav-text">安装 maven，并且用 maven 打 war 包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建库表并且配置正确的数据库链接"><span class="nav-number">3.1.6.</span> <span class="nav-text">创建库表并且配置正确的数据库链接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#设置-CORS-跨域"><span class="nav-number">3.1.7.</span> <span class="nav-text">设置 CORS 跨域</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nginx-代理转发"><span class="nav-number">3.1.8.</span> <span class="nav-text">nginx 代理转发</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#部署-LoganSite-端"><span class="nav-number">3.2.</span> <span class="nav-text">部署 LoganSite 端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#接入-WEB-SDK-测试"><span class="nav-number">3.3.</span> <span class="nav-text">接入 WEB SDK 测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">4.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zach Ke</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://zach-2.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://kebingzao.com/2021/08/19/use-web-logan/';
          this.page.identifier = '2021/08/19/use-web-logan/';
          this.page.title = '使用 Logan 来做前端日志系统';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://zach-2.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("HIV4XRdKJXB0eaFgtSjiVNaK-gzGzoHsz", "zN3v8grxW0Q8eXwNlEgXxWrF");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  



</body>
</html>
