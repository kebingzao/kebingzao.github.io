<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <script src="/live2d-widget/live2d-widget-resource/jquery.min.js"></script>
  <link rel="stylesheet" href="/live2d-widget/live2d-widget-resource/font-awesome.min.css"/>
  <script src="/live2d-widget/autoload.js"></script>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />


















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="npm,verdaccio," />










<meta name="description" content="å‰è¨€éšç€å‰ç«¯é¡¹ç›®è¶Šæ¥è¶Šå¤šï¼Œå°¤å…¶æ˜¯å†…éƒ¨çš„ js lib åº“è¶Šæ¥è¶Šå¤šï¼Œæ€ä¹ˆæœ‰æ•ˆçš„ç®¡ç† lib åº“çš„å‘å¸ƒï¼Œå°±å˜æˆä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜äº†ã€‚ ä»¥ä¹‹å‰åšçš„ air-ui æ¥è¯´ï¼Œå…¶å®åœ¨è¿›è¡Œç‰ˆæœ¬å‘å¸ƒçš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯ä¸æ±¡æŸ“ gitlab ä¸Šçš„ master åˆ†æ”¯ï¼Œæ‰€ä»¥å°±ä¸“é—¨å†™äº†è„šæœ¬åœ¨ç‰ˆæœ¬å‘å¸ƒçš„æ—¶å€™ï¼Œè¿›è¡Œåˆ†æ”¯åˆ‡æ¢æ¥å¤„ç†ï¼Œå…·ä½“æ­¥éª¤å¤šåˆç¹ç:123456781. æ£€æŸ¥å½“å‰åˆ†æ”¯æ˜¯å¦æ˜¯è¿œç¨‹çš„ master åˆ†æ”¯ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¿”å›é”™">
<meta name="keywords" content="npm,verdaccio">
<meta property="og:type" content="article">
<meta property="og:title" content="ä½¿ç”¨ verdaccio æ­å»ºå‰ç«¯å†…éƒ¨ç§æœ‰ npm ä»“åº“">
<meta property="og:url" content="http://kebingzao.com/2023/09/19/npm-verdaccio/index.html">
<meta property="og:site_name" content="Zach Ke&#39;s Notes">
<meta property="og:description" content="å‰è¨€éšç€å‰ç«¯é¡¹ç›®è¶Šæ¥è¶Šå¤šï¼Œå°¤å…¶æ˜¯å†…éƒ¨çš„ js lib åº“è¶Šæ¥è¶Šå¤šï¼Œæ€ä¹ˆæœ‰æ•ˆçš„ç®¡ç† lib åº“çš„å‘å¸ƒï¼Œå°±å˜æˆä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜äº†ã€‚ ä»¥ä¹‹å‰åšçš„ air-ui æ¥è¯´ï¼Œå…¶å®åœ¨è¿›è¡Œç‰ˆæœ¬å‘å¸ƒçš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯ä¸æ±¡æŸ“ gitlab ä¸Šçš„ master åˆ†æ”¯ï¼Œæ‰€ä»¥å°±ä¸“é—¨å†™äº†è„šæœ¬åœ¨ç‰ˆæœ¬å‘å¸ƒçš„æ—¶å€™ï¼Œè¿›è¡Œåˆ†æ”¯åˆ‡æ¢æ¥å¤„ç†ï¼Œå…·ä½“æ­¥éª¤å¤šåˆç¹ç:123456781. æ£€æŸ¥å½“å‰åˆ†æ”¯æ˜¯å¦æ˜¯è¿œç¨‹çš„ master åˆ†æ”¯ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¿”å›é”™">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://kebingzao.com/2023/09/19/npm-verdaccio/1.png">
<meta property="og:image" content="http://kebingzao.com/2023/09/19/npm-verdaccio/2.png">
<meta property="og:image" content="http://kebingzao.com/2023/09/19/npm-verdaccio/3.png">
<meta property="og:image" content="http://kebingzao.com/2023/09/19/npm-verdaccio/4.png">
<meta property="og:image" content="http://kebingzao.com/2023/09/19/npm-verdaccio/5.png">
<meta property="og:image" content="http://kebingzao.com/2023/09/19/npm-verdaccio/6.png">
<meta property="og:image" content="http://kebingzao.com/2023/09/19/npm-verdaccio/7.png">
<meta property="og:image" content="http://kebingzao.com/2023/09/19/npm-verdaccio/8.png">
<meta property="og:image" content="http://kebingzao.com/2023/09/19/npm-verdaccio/9.png">
<meta property="og:image" content="http://kebingzao.com/2023/09/19/npm-verdaccio/10.png">
<meta property="og:image" content="http://kebingzao.com/2023/09/19/npm-verdaccio/11.png">
<meta property="og:updated_time" content="2024-03-02T09:57:46.116Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ä½¿ç”¨ verdaccio æ­å»ºå‰ç«¯å†…éƒ¨ç§æœ‰ npm ä»“åº“">
<meta name="twitter:description" content="å‰è¨€éšç€å‰ç«¯é¡¹ç›®è¶Šæ¥è¶Šå¤šï¼Œå°¤å…¶æ˜¯å†…éƒ¨çš„ js lib åº“è¶Šæ¥è¶Šå¤šï¼Œæ€ä¹ˆæœ‰æ•ˆçš„ç®¡ç† lib åº“çš„å‘å¸ƒï¼Œå°±å˜æˆä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜äº†ã€‚ ä»¥ä¹‹å‰åšçš„ air-ui æ¥è¯´ï¼Œå…¶å®åœ¨è¿›è¡Œç‰ˆæœ¬å‘å¸ƒçš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯ä¸æ±¡æŸ“ gitlab ä¸Šçš„ master åˆ†æ”¯ï¼Œæ‰€ä»¥å°±ä¸“é—¨å†™äº†è„šæœ¬åœ¨ç‰ˆæœ¬å‘å¸ƒçš„æ—¶å€™ï¼Œè¿›è¡Œåˆ†æ”¯åˆ‡æ¢æ¥å¤„ç†ï¼Œå…·ä½“æ­¥éª¤å¤šåˆç¹ç:123456781. æ£€æŸ¥å½“å‰åˆ†æ”¯æ˜¯å¦æ˜¯è¿œç¨‹çš„ master åˆ†æ”¯ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¿”å›é”™">
<meta name="twitter:image" content="http://kebingzao.com/2023/09/19/npm-verdaccio/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: 'KGVI6VPIBI',
      apiKey: '41c2ccc830ca183768a6bf1e50a03f44',
      indexName: 'test_blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://kebingzao.com/2023/09/19/npm-verdaccio/"/>





  <title>ä½¿ç”¨ verdaccio æ­å»ºå‰ç«¯å†…éƒ¨ç§æœ‰ npm ä»“åº“ | Zach Ke's Notes</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <a href="https://github.com/kebingzao" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zach Ke's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Quick notes</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kebingzao.com/2023/09/19/npm-verdaccio/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zach Ke">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zach Ke's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ä½¿ç”¨ verdaccio æ­å»ºå‰ç«¯å†…éƒ¨ç§æœ‰ npm ä»“åº“</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2023-09-19T18:38:25+08:00">
                2023-09-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nodeç›¸å…³/" itemprop="url" rel="index">
                    <span itemprop="name">nodeç›¸å…³</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2023/09/19/npm-verdaccio/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2023/09/19/npm-verdaccio/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2023/09/19/npm-verdaccio/" class="leancloud_visitors" data-flag-title="ä½¿ç”¨ verdaccio æ­å»ºå‰ç«¯å†…éƒ¨ç§æœ‰ npm ä»“åº“">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>éšç€å‰ç«¯é¡¹ç›®è¶Šæ¥è¶Šå¤šï¼Œå°¤å…¶æ˜¯å†…éƒ¨çš„ js lib åº“è¶Šæ¥è¶Šå¤šï¼Œæ€ä¹ˆæœ‰æ•ˆçš„ç®¡ç† lib åº“çš„å‘å¸ƒï¼Œå°±å˜æˆä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜äº†ã€‚</p>
<p>ä»¥ä¹‹å‰åšçš„ air-ui æ¥è¯´ï¼Œå…¶å®åœ¨è¿›è¡Œç‰ˆæœ¬å‘å¸ƒçš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯ä¸æ±¡æŸ“ gitlab ä¸Šçš„ master åˆ†æ”¯ï¼Œæ‰€ä»¥å°±ä¸“é—¨å†™äº†è„šæœ¬åœ¨ç‰ˆæœ¬å‘å¸ƒçš„æ—¶å€™ï¼Œè¿›è¡Œåˆ†æ”¯åˆ‡æ¢æ¥å¤„ç†ï¼Œå…·ä½“æ­¥éª¤å¤šåˆç¹ç:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. æ£€æŸ¥å½“å‰åˆ†æ”¯æ˜¯å¦æ˜¯è¿œç¨‹çš„ master åˆ†æ”¯ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¿”å›é”™è¯¯</span><br><span class="line">2. æ‰§è¡Œ yarn distï¼Œ ç”Ÿæˆ lib ç›®å½•</span><br><span class="line">3. å°† lib ç›®å½•ä¿å­˜åˆ°ä¸€ä¸ª gitignore çš„ä¸€ä¸ªç›®å½• lib_tmp</span><br><span class="line">4. commit and push master åˆ†æ”¯ ï¼ˆå¦‚æœ status æœ‰æ”¹å˜çš„è¯ï¼‰</span><br><span class="line">5. åˆ‡æ¢åˆ° master-release åˆ†æ”¯ï¼Œå°† lib_tmp çš„æ–‡ä»¶è¦†ç›– lib ç›®å½•</span><br><span class="line">6. commit and push master-release åˆ†æ”¯</span><br><span class="line">7. master-release æ‰“ tag</span><br><span class="line">8. æŠŠä¸´æ—¶æ–‡ä»¶ lib_tmp åˆ æ‰</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>å…·ä½“ç»†èŠ‚æŸ¥çœ‹ <a href="/2020/01/13/air-ui-16/" title="è‡ªå»ºvueç»„ä»¶ air-ui (16) -- æ‰“åŒ…æ„å»º pub ä»»åŠ¡">è‡ªå»ºvueç»„ä»¶ air-ui (16) -- æ‰“åŒ…æ„å»º pub ä»»åŠ¡</a></p>
</blockquote>
<p>è¿™ç§æµç¨‹æ˜¯æœ‰ä¸€äº›ç¼ºç‚¹å’Œé—®é¢˜çš„:</p>
<ol>
<li><strong>å‘å¸ƒæµç¨‹å¤æ‚åŒ–ï¼š</strong> éœ€è¦ç¼–å†™ä¸“é—¨çš„è„šæœ¬æ¥ç¡®å®šå“ªäº›æ„å»ºäº§ç‰©çš„ä»£ç éœ€è¦å‘å¸ƒï¼ŒåŒæ—¶è¿˜éœ€æ‰‹åŠ¨åˆ é™¤ä¸å¿…è¦çš„ä»£ç ã€‚</li>
<li><strong>å®¹æ˜“äº§ç”Ÿæ··æ·†ï¼š</strong> ä½¿ç”¨ <code>git tag</code> æ¥å‘å¸ƒä»£ç å¯èƒ½ä¼šå¼•èµ·æ··æ·†ï¼Œå› ä¸ºå®ƒé€šå¸¸ç”¨äºæ ‡è®°ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯å‘å¸ƒä»£ç ã€‚</li>
<li><strong>æ— æ³•åˆ©ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶çš„èŒƒå›´ï¼ˆä¾‹å¦‚ï¼š^1.0.0 æˆ– ~1.0.0ï¼‰æ¥ç²¾ç¡®æŒ‡å®šä¾èµ–çš„ç‰ˆæœ¬</strong></li>
</ol>
<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬æœ‰è‡ªå·±çš„ npm åº“çš„è¯ï¼Œå…¶å®å¯¹äºåº“çš„å‘å¸ƒå°±å˜å¾—éå¸¸ç®€å•ï¼Œåªéœ€è¦ç®€å•çš„ 3 æ­¥:</p>
<ol>
<li>æ›´æ–°<code>package.json</code>ä¸­çš„ç‰ˆæœ¬å·</li>
<li>ä»£ç æ„å»º</li>
<li>æœ€åæ‰§è¡Œ<code>npm publish</code>å‘½ä»¤ï¼Œå³å‘å¸ƒæˆåŠŸ</li>
</ol>
<a id="more"></a>
<p>æ ¹æœ¬ä¸éœ€è¦å¯¹é¡¹ç›®çš„ä»£ç åšè€¦åˆã€‚ è€Œä¸”éšç€é¡¹ç›®çš„è¿­ä»£å’Œæ–°å¢ï¼Œå†…éƒ¨ç»´æŠ¤è‡ªå·±çš„ js åº“ï¼Œä¸ç®¡æ˜¯ç»„ä»¶åº“ï¼Œè¿˜æ˜¯å·¥å…·åº“ï¼Œæˆ–è€…æ˜¯ä¸šåŠ¡åº“ï¼Œå…¶å®éƒ½ä¼šå˜å¾—è¶Šæ¥è¶Šå¤šã€‚å› æ­¤æ˜¯éœ€è¦æ­å»ºè‡ªå·±çš„å†…éƒ¨ npm åº“çš„ã€‚å®ƒä¸ä»…ä¼šç®€åŒ–jsåº“å‘å¸ƒæµç¨‹ï¼Œè¿˜å¯ä»¥å¢å¼ºå‰ç«¯å„é¡¹ç›®é€šç”¨ä»£ç æµé€šã€‚</p>
<h2 id="verdaccio-ç®€ä»‹"><a href="#verdaccio-ç®€ä»‹" class="headerlink" title="verdaccio ç®€ä»‹"></a>verdaccio ç®€ä»‹</h2><p>æˆ‘ä»¬ä½¿ç”¨ verdaccio éƒ¨ç½²äº†npm ç§æœ‰æº, <a href="https://verdaccio.org/docs/next/what-is-verdaccio" target="_blank" rel="noopener">Verdaccio</a> æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ç§æœ‰ npm ä»£ç†æ³¨å†ŒæœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ å»ºç«‹è‡ªå·±çš„ç§æœ‰ä»“åº“ï¼Œå¯¹ npm åŒ…è¿›è¡Œç®¡ç†ã€‚ä»¥ä¸‹æ˜¯ Verdaccio çš„ä¸€äº›ä¸»è¦åŠŸèƒ½ï¼š</p>
<ol>
<li><strong>ç§æœ‰åŒ…ç®¡ç†</strong>ï¼šä½ å¯ä»¥ä½¿ç”¨ Verdaccio æ¥å‘å¸ƒå’Œå­˜å‚¨ä½ çš„ç§æœ‰åŒ…ï¼Œè¿™å¯¹äºä¿æŠ¤ä½ çš„æºä»£ç å’Œå†…éƒ¨ä½¿ç”¨çš„åŒ…éå¸¸æœ‰ç”¨ã€‚</li>
<li><strong>ç¼“å­˜ä»£ç†</strong>ï¼šVerdaccio å¯ä»¥ä½œä¸ºä¸€ä¸ª npm ä»£ç†ï¼Œå®ƒä¼šç¼“å­˜æ‰€æœ‰ä» npmjs.com ä¸‹è½½çš„å…¬å…±åŒ…ï¼Œè¿™æ ·å³ä½¿ä½ å¤±å»äº†ä¸ npmjs.com çš„è¿æ¥ï¼Œä½ ä»ç„¶å¯ä»¥å®‰è£…è¿™äº›åŒ…ã€‚</li>
<li><strong>æƒé™æ§åˆ¶</strong>ï¼šVerdaccio æ”¯æŒç”¨æˆ·è®¤è¯å’ŒåŒ…æƒé™æ§åˆ¶ï¼Œä½ å¯ä»¥æ§åˆ¶è°å¯ä»¥è®¿é—®å’Œå‘å¸ƒä½ çš„ç§æœ‰åŒ…ã€‚</li>
<li><strong>æ˜“äºæ‰©å±•</strong>ï¼šVerdaccio æ”¯æŒæ’ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨æ’ä»¶æ¥æ‰©å±• Verdaccio çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ·»åŠ æ–°çš„è®¤è¯æ–¹æ³•ï¼Œæ”¹å˜å­˜å‚¨æ–¹å¼ç­‰ã€‚</li>
<li><strong>å…¼å®¹æ€§</strong>ï¼šVerdaccio å®Œå…¨å…¼å®¹ npmjs.comï¼Œä½ å¯ä»¥ä½¿ç”¨ npm æˆ–è€… yarn ç­‰å·¥å…·æ¥ä¸ Verdaccio äº¤äº’ã€‚</li>
<li><strong>æ˜“äºéƒ¨ç½²</strong>ï¼šVerdaccio å¯ä»¥åœ¨å¤šç§ç¯å¢ƒä¸­éƒ¨ç½²ï¼ŒåŒ…æ‹¬ Dockerï¼ŒKubernetesï¼Œäº‘æœåŠ¡ç­‰ã€‚</li>
<li><strong>Web UI</strong>ï¼šVerdaccio æä¾›äº†ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„ web ç•Œé¢ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ªç•Œé¢ä¸Šæœç´¢å’Œç®¡ç†ä½ çš„åŒ…ã€‚</li>
</ol>
<p>æ¥ä¸‹æ¥å¼€å§‹è¿›å…¥å®æ“ç¯èŠ‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>Verdaccio æœ‰å¤šç§å®‰è£…ï¼Œå› ä¸ºæ˜¯å®‰è£…åœ¨æœåŠ¡ç«¯ï¼Œå› æ­¤ä¸ºäº†ä¸æ±¡æŸ“æœåŠ¡å™¨å…¨å±€ç¯å¢ƒï¼Œæˆ‘è¿™è¾¹æ˜¯ä½¿ç”¨ docker æ¥å®‰è£…: <a href="https://verdaccio.org/docs/next/docker" target="_blank" rel="noopener">Running Verdaccio using Docker</a></p>
<blockquote>
<p>æˆ‘çš„å®‰è£…ç¯å¢ƒæ˜¯ CentOS 7</p>
</blockquote>
<h3 id="å®‰è£…-docker"><a href="#å®‰è£…-docker" class="headerlink" title="å®‰è£… docker"></a>å®‰è£… docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-64-9-centos ~]# sudo yum install -y yum-utils</span><br><span class="line">[root@VM-64-9-centos ~]# sudo yum-config-manager \</span><br><span class="line">&gt; --add-repo \</span><br><span class="line">&gt; https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">[root@VM-64-9-centos ~]# sudo yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line">[root@VM-64-9-centos ~]# sudo systemctl start docker</span><br><span class="line">root@VM-1-3-centos ~]# docker -v</span><br><span class="line">Docker version 24.0.6, build ed223bc</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…é•œåƒ"><a href="#å®‰è£…é•œåƒ" class="headerlink" title="å®‰è£…é•œåƒ"></a>å®‰è£…é•œåƒ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">V_PATH=/etc/verdaccio; docker run -d -it  --name verdaccio   \</span><br><span class="line">  -p 4873:4873   \</span><br><span class="line">  -v $V_PATH/conf:/verdaccio/conf   \</span><br><span class="line">  -v $V_PATH/storage:/verdaccio/storage   \</span><br><span class="line">  -v $V_PATH/plugins:/verdaccio/plugins  \</span><br><span class="line">  verdaccio/verdaccio</span><br></pre></td></tr></table></figure>
<p>è¿™è¾¹æ˜¯ç›´æ¥ç”¨æŒ‚è½½å®¿ä¸»æœº <code>/etc/verdaccio</code> ç›®å½•çš„æ–¹å¼æ¥å¯¹ verdaccio çš„æŒä¹…åŒ–æ•°æ®è¿›è¡Œç»´æŠ¤, <code>-d</code> è¡¨ç¤ºåå°è¿è¡Œ</p>
<blockquote>
<p>ä¸éœ€è¦å…ˆæ‹‰å–é•œåƒï¼Œå¯åŠ¨çš„æ—¶å€™ï¼Œå¦‚æœæœ¬åœ°æ‰¾ä¸åˆ°é•œåƒï¼Œä¼šè‡ªå·±çš„ pull çº¿ä¸Šçš„é•œåƒ</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-1-3-centos conf]# V_PATH=/etc/verdaccio; docker run -d -it  --name verdaccio   -p 4873:4873   -v $V_PATH/conf:/verdaccio/conf   -v $V_PATH/storage:/verdaccio/storage   -v $V_PATH/plugins:/verdaccio/plugins   verdaccio/verdaccio</span><br><span class="line">ddaaa3532dd313cab24302011fe439c36771fbbb794f6869af650d9a13404e4e</span><br><span class="line">[root@VM-1-3-centos conf]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND                  CREATED         STATUS         PORTS                                       NAMES</span><br><span class="line">ddaaa3532dd3   verdaccio/verdaccio   &quot;uid_entrypoint /binâ€¦&quot;   5 seconds ago   Up 5 seconds   0.0.0.0:4873-&gt;4873/tcp, :::4873-&gt;4873/tcp   verdaccio</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡è¿™è¾¹è¦æ³¨æ„ä¸€ä¸ªç»†èŠ‚ï¼Œå› ä¸ºæ˜¯èµ°æŒ‚è½½çš„æ–¹å¼ï¼Œæ‰€ä»¥å¯åŠ¨ docker æ—¶å€™çš„é…ç½®æ–‡ä»¶ <code>config.yaml</code>ï¼Œæˆ‘ä»¬è¦å…ˆåˆ›å»ºå¥½ï¼Œç›´æ¥æ‹·è´å®˜ç½‘ github ä¸Šçš„é»˜è®¤æ–‡ä»¶å³å¯: <a href="https://github.com/verdaccio/verdaccio/blob/5.x/conf/docker.yaml" target="_blank" rel="noopener">config.yaml</a></p>
<blockquote>
<p>è®°å¾—é‡å‘½åä¸º <code>config.yaml</code>, å®Œæ•´è·¯å¾„æ˜¯: <code>/etc/verdaccio/conf/config.yaml</code></p>
</blockquote>
<p>å¦‚æœåˆšå¼€å§‹æ²¡æœ‰è¿™ä¸ªé…ç½®æ–‡ä»¶çš„è¯ï¼Œå¯åŠ¨ docker çš„æ—¶å€™å°±ä¼šæŠ¥è¿™ä¸ªé”™è¯¯:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cannot open config file /verdaccio/conf/config.yaml: false</span><br></pre></td></tr></table></figure></p>
<p>å½“ docker å¯åŠ¨ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>docker logs -f verdaccio</code> æŸ¥çœ‹å½“å‰è¿™ä¸ªå®¹å™¨çš„å½“å‰ log è¾“å‡ºã€‚</p>
<p>åŒæ—¶ä¹Ÿå› ä¸ºå¯åŠ¨æˆåŠŸï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥æŸ¥çœ‹ webui ç•Œé¢ï¼Œç«¯å£å°±æ˜¯ä¸Šé¢çš„ <code>4873</code></p>
<p><img src="/2023/09/19/npm-verdaccio/1.png" alt="1"></p>
<h2 id="é…ç½®æ–‡ä»¶åˆ†æ"><a href="#é…ç½®æ–‡ä»¶åˆ†æ" class="headerlink" title="é…ç½®æ–‡ä»¶åˆ†æ"></a>é…ç½®æ–‡ä»¶åˆ†æ</h2><p>ç°åœ¨æœåŠ¡å·²ç»å¯åŠ¨äº†ï¼Œç”¨çš„é…ç½®æ–‡ä»¶æ˜¯é»˜è®¤çš„é…ç½®ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹éƒ½æœ‰å“ªäº›é…ç½®ï¼Œä¸‹é¢åªåˆ—å‡º <code>config.yaml</code> æ–‡ä»¶ä¸­æœ‰å¯ç”¨çš„é…ç½®:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"># å­˜æ”¾åŒ…çš„ç›®å½•</span><br><span class="line">storage: /verdaccio/storage/data</span><br><span class="line"># å­˜æ”¾æ’ä»¶çš„ç›®å½•</span><br><span class="line">plugins: /verdaccio/plugins</span><br><span class="line"></span><br><span class="line"># https://verdaccio.org/docs/webui</span><br><span class="line"># webui ç•Œé¢çš„é…ç½®</span><br><span class="line">web:</span><br><span class="line">  title: Verdaccio</span><br><span class="line"></span><br><span class="line"># https://verdaccio.org/docs/configuration#authentication</span><br><span class="line"># æƒé™æ ¡éªŒï¼Œé€šè¿‡ adduser åˆ›å»ºçš„ç”¨æˆ·ä¿¡æ¯ï¼Œä¼šæ”¾åœ¨è¿™ä¸ªæ–‡ä»¶</span><br><span class="line">auth:</span><br><span class="line">  htpasswd:</span><br><span class="line">    file: /verdaccio/storage/htpasswd</span><br><span class="line"></span><br><span class="line"># https://verdaccio.org/docs/configuration#uplinks</span><br><span class="line"># å…¶ä»–ä»£ç†çš„èµ„æºåº“ï¼Œåœ¨è®¾ç½® packages æƒé™çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® proxy æ¥ä»£ç†ä¸‹è½½å¤–éƒ¨èµ„æºåŒ…ï¼Œé»˜è®¤æ˜¯èµ° npmjs å®˜ç½‘</span><br><span class="line"># å½“ç„¶ä¹Ÿå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œæ¯”å¦‚ä¹Ÿå¯ä»¥è®¾ç½®æ·˜å®æºï¼Œç„¶åå¯ä»¥è‡ªå·±æŒ‡å®šä¸åŒ scope package åŒ…çš„æ—¶å€™ï¼Œå¦‚æœæœ¬ç§æœ‰åº“æ‰¾ä¸åˆ°ï¼Œå¯ä»¥é€šè¿‡èµ°ä¸åŒçš„ uplink èµ„æºåº“æ¥è¿›è¡Œä»£ç†ä¸‹è½½</span><br><span class="line">uplinks:</span><br><span class="line">  npmjs:</span><br><span class="line">    url: https://registry.npmjs.org/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># https://verdaccio.org/docs/protect-your-dependencies/</span><br><span class="line"># https://verdaccio.org/docs/configuration#packages</span><br><span class="line"># åŒ…æƒé™ç®¡ç†ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„ scope æ¥è®¾ç½®ä¸åŒæƒé™ï¼Œé»˜è®¤å°±æ˜¯è®¿é—®ä¸‹è½½æ˜¯æ‰€æœ‰äººï¼Œä½†æ˜¯ publish å’Œ unpublish æ˜¯è¦æœ‰ç”¨æˆ·ç™»å½•æƒé™æ‰è¡Œ</span><br><span class="line"># ç„¶åä¹Ÿå¯ä»¥é€šè¿‡é…ç½® proxy ä»£ç†æºï¼Œåœ¨å½“æ‰¾ä¸åˆ°åŒ…çš„æ—¶å€™ï¼Œå¯ä»¥å»å¤–ç½‘ä¸‹è½½åŒ…</span><br><span class="line">packages:</span><br><span class="line">  &apos;@*/*&apos;:</span><br><span class="line">    access: $all</span><br><span class="line">    publish: $authenticated</span><br><span class="line">    unpublish: $authenticated</span><br><span class="line">    proxy: npmjs</span><br><span class="line"></span><br><span class="line">  &apos;**&apos;:</span><br><span class="line">    access: $all</span><br><span class="line">    publish: $authenticated</span><br><span class="line">    unpublish: $authenticated</span><br><span class="line">    proxy: npmjs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># https://verdaccio.org/docs/configuration#server</span><br><span class="line"># ç”¨æ¥ä¿®æ”¹æœåŠ¡å™¨å±æ€§</span><br><span class="line">server:</span><br><span class="line">  keepAliveTimeout: 60</span><br><span class="line"></span><br><span class="line"># https://verdaccio.org/docs/configuration/#audit</span><br><span class="line"># æ ¡éªŒä¸­é—´ä»¶</span><br><span class="line">middlewares:</span><br><span class="line">  audit:</span><br><span class="line">    enabled: true</span><br><span class="line"></span><br><span class="line"># https://verdaccio.org/docs/logger</span><br><span class="line"># log è¾“å‡ºè®¾ç½®ï¼Œä¹Ÿå¯ä»¥è®¾ç½®è¾“å‡ºåˆ° file </span><br><span class="line">log: &#123; type: stdout, format: pretty, level: http &#125;</span><br></pre></td></tr></table></figure></p>
<p>é»˜è®¤é…ç½®å…¶å®ä¸å¤šï¼Œå¹¶ä¸”å®˜æ–¹æ–‡æ¡£å…¶å®è¯´çš„å¾ˆæ¸…æ¥šäº†ï¼Œè¿™è¾¹ä¸å†èµ˜è¿°ï¼Œ æ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨æœ‰æŒ‚è½½ <code>conf</code> å’Œ <code>storage</code> å’Œ <code>plugin</code> ç›®å½•çš„æƒ…å†µä¸‹ï¼Œé…ç½®é¡¹ä¿æŒé»˜è®¤å…¶å®å°±å¤Ÿäº†ï¼Œåé¢å¦‚æœéœ€è¦è°ƒæ•´çš„è¯ï¼Œä¸‹é¢ä¼šå•ç‹¬è¯´æ˜</p>
<h2 id="å®é™…æ“ä½œ"><a href="#å®é™…æ“ä½œ" class="headerlink" title="å®é™…æ“ä½œ"></a>å®é™…æ“ä½œ</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®é™…æ“ä½œæ•´ä¸ªè¿‡ç¨‹</p>
<blockquote>
<p>æœ¬æ¬¡æµ‹è¯•çš„å®¢æˆ·ç«¯çš„ node ç‰ˆæœ¬æ˜¯ <code>16.20.0</code> ç‰ˆæœ¬</p>
</blockquote>
<h3 id="1-åˆ›å»ºè´¦å·"><a href="#1-åˆ›å»ºè´¦å·" class="headerlink" title="1. åˆ›å»ºè´¦å·"></a>1. åˆ›å»ºè´¦å·</h3><p>è¦å‘å¸ƒçš„è¯ï¼Œè‚¯å®šæ˜¯è¦æœ‰ä¸€ä¸ªè´¦å·çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè‚¯å®šæ˜¯æ²¡æœ‰è´¦å·çš„ (ä½¿ç”¨ <code>npm whoami</code> æŸ¥çœ‹å½“å‰ç”¨æˆ·ï¼Œè¦æŒ‡å®šæºï¼Œä¸ç„¶å°±ä¼šæŒ‡å‘é»˜è®¤æº):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;npm whoami --registry http://43.139.27.159:4873/</span><br><span class="line">npm ERR! code ENEEDAUTH</span><br><span class="line">npm ERR! need auth This command requires you to be logged in.</span><br><span class="line">npm ERR! need auth You need to authorize this machine using `npm adduser`</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡ <code>adduser</code> åˆ›å»ºä¸€ä¸ª<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;npm adduser --registry http://43.139.27.159:4873/</span><br><span class="line">npm WARN adduser `adduser` will be split into `login` and `register` in a future version. `adduser` will become an alias of `register`. `login` (currently an alias) will become its own command.</span><br><span class="line">npm notice Log in on http://43.139.27.159:4873/</span><br><span class="line">Username: zachke</span><br><span class="line">Password:</span><br><span class="line">Email: (this IS public) kebingzao@gmail.com</span><br><span class="line">Logged in as zachke on http://43.139.27.159:4873/.</span><br></pre></td></tr></table></figure></p>
<p>ä¸è¿‡è¿™è¾¹è¦æ³¨æ„ä¸€ä¸ªç»†èŠ‚ï¼Œå°±æ˜¯å¦‚æœæ˜¯ç”¨ docker å®‰è£…çš„è¯ï¼Œå› ä¸ºç”¨æˆ·æ–°å¢çš„æ—¶å€™ï¼Œä¼šå†™å…¥ htpasswd æ–‡ä»¶ï¼Œç”±äºè¯¥æ–‡ä»¶æ˜¯åœ¨å®¿ä¸»æœºä¸Šï¼Œä¹Ÿå°±æ˜¯ <code>/etc/verdaccio/storage/htpasswd</code> è¿™ä¸ªæ–‡ä»¶ï¼Œè€Œ verdaccio å®¹å™¨ä¸­æ‹¥æœ‰è‡ªå·±çš„ç”¨æˆ·åï¼Œåå­—å°±å« verdaccioï¼Œæ‰€ä»¥æ— æ³•å†™å…¥ root ç”¨æˆ·æ‹¥æœ‰çš„æ–‡ä»¶ã€‚</p>
<p>æ‰€ä»¥è¿™æ—¶å€™åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm ERR! 500 Internal Server Error - PUT http://43.139.27.159:4873/-/user/org.couchdb.user:zachke - internal server error</span><br></pre></td></tr></table></figure></p>
<p>è§£å†³çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œåªè¦å°†å®¿ä¸»æœºçš„è¿™ä¸ª storage ç›®å½•çš„ owner è®¾ç½®ä¸º verdaccio ç”¨æˆ·å³å¯ã€‚è€Œä¸” docker å®¹å™¨ä¸­çš„ uid å’Œ gid å’Œå®¿ä¸»æœºæ˜¯å…±äº«çš„ï¼Œåªä¸è¿‡æ²¡æœ‰å…·ä½“çš„åç§°ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬é€šè¿‡ <code>docker inspect verdaccio</code> æŸ¥çœ‹ uid, å‘ç°æ˜¯ <code>10001</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-1-3-centos ~]# docker inspect verdaccio | grep UID</span><br><span class="line">                &quot;VERDACCIO_USER_UID=10001&quot;,</span><br></pre></td></tr></table></figure></p>
<p>è‡³äº gidï¼Œå°±éœ€è¦è¿›å…¥åˆ°è¿™ä¸ªå®¹å™¨ä¸­ï¼Œå¹¶ä¸”æ‰“å¼€ç”¨æˆ·ç»„æ–‡ä»¶è¿›è¡ŒæŸ¥æ‰¾, å¯ä»¥çœ‹åˆ°æ˜¯ <code>65533</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~ $ cat /etc/group | grep verdaccio</span><br><span class="line">nogroup:x:65533:verdaccio</span><br></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥åœ¨å®¿ä¸»æœºæ”¹ä¸€ä¸‹ storage çš„æƒé™å³å¯ï¼Œæ”¹æˆ verdaccio çš„ user idï¼Œå’Œ group idï¼Œä¹Ÿå°±æ˜¯ 10001 å’Œ 65533, <code>-R</code> è¡¨ç¤ºå­ç›®å½•ä¹ŸåŒæ ·éœ€è¦<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-1-3-centos verdaccio]# sudo chown -R 10001:65533 /etc/verdaccio/storage</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å­å°±å¯ä»¥åˆ›å»ºæˆåŠŸäº†:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;npm whoami --registry http://43.139.27.159:4873/</span><br><span class="line">zachke</span><br></pre></td></tr></table></figure></p>
<p>ä¹Ÿå¯ä»¥åœ¨ <code>storage/htpasswd</code> è¿™ä¸ªæŸ¥çœ‹è¿™ä¸ªæ–‡ä»¶ï¼Œ å°±å¯ä»¥å‘ç°å·²ç»æœ‰ä¸€ä¸ªç”¨æˆ·äº†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-1-3-centos verdaccio]# cat /etc/verdaccio/storage/htpasswd</span><br><span class="line">zachke:wKTp2Zn.123456:autocreated 2023-09-18T02:25:30.987Z</span><br></pre></td></tr></table></figure></p>
<p>åŒæ—¶é€šè¿‡è¿™ä¸ªè´¦å·ä¹Ÿå¯ä»¥ç™»å½• web ui åå°</p>
<p><img src="/2023/09/19/npm-verdaccio/2.png" alt="1"></p>
<p>æ—¢ç„¶æœ‰æ·»åŠ ç”¨æˆ·ï¼Œé‚£è‚¯å®šæœ‰ç™»å½•å’Œç™»å‡º:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm login --registry http://43.139.27.159:4873/</span><br><span class="line">npm logout --registry http://43.139.27.159:4873/</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>æ·»åŠ ç”¨æˆ·å°±é»˜è®¤ç™»å½•äº†,å¦‚æœè¦åˆ‡æ¢åŒä¸€ä¸ªæºçš„ä¸åŒç”¨æˆ·ï¼Œå°±è¦å…ˆç™»å‡ºï¼Œç„¶åå†ç™»å½•</p>
</blockquote>
<h3 id="2-åˆ›å»ºé¡¹ç›®"><a href="#2-åˆ›å»ºé¡¹ç›®" class="headerlink" title="2. åˆ›å»ºé¡¹ç›®"></a>2. åˆ›å»ºé¡¹ç›®</h3><p>æ¥ä¸‹æ¥å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®, ä½¿ç”¨ <code>npm init</code> æŒ‡ä»¤å¯ä»¥å¿«é€Ÿç”Ÿæˆä¸€ä¸ªåªåŒ…å« <code>package.json</code> æ–‡ä»¶çš„é¡¹ç›®:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir testlog</span><br><span class="line">$ cd testlog/</span><br><span class="line">$ npm init</span><br></pre></td></tr></table></figure></p>
<p>åŸºæœ¬ä¸Šä¸€è·¯é»˜è®¤ä¸‹å»ï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªé¡¹ç›®äº†ã€‚</p>
<blockquote>
<p>å¦‚æœä¸æƒ³ä¸€ä¸ªä¸€ä¸ªé¡¹çš„é…ç½®ï¼Œç›´æ¥ä½¿ç”¨ <code>npm init -y</code> æŒ‡ä»¤åˆ›å»ºï¼Œå°±ä¼šç”Ÿæˆä¸€ä»½å…¨éƒ¨èµ°é»˜è®¤å€¼çš„<code>package.json</code> æ–‡ä»¶</p>
</blockquote>
<p>è¿™æ—¶å€™è¿™ä¸ª testlog é¡¹ç›®å°±ä¼šæœ‰ä¸€ä¸ª <code>package.json</code> çš„æ–‡ä»¶äº†<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"testlog"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"is test log"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å•ç‹¬åªæœ‰è¿™ä¸ªæ–‡ä»¶è‚¯å®šæ˜¯ä¸è¡Œï¼Œå› ä¸ºä¸Šé¢çš„ <code>main</code> å­—æ®µå·²ç»é»˜è®¤å…¥å£æ–‡ä»¶æ˜¯ <code>index.js</code>, æ‰€ä»¥è¿™æ—¶å€™éœ€è¦å†åˆ›å»ºä¸€ä¸ª <code>index.js</code> æ–‡ä»¶æ¥å½“ä½œå…¥å£æ–‡ä»¶ï¼Œ å†…å®¹å¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function mylog() &#123;</span><br><span class="line">    console.log(&apos;mylog: &apos;, ...arguments);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;mylog&#125;;</span><br></pre></td></tr></table></figure></p>
<p>åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯é’ˆå¯¹ <code>console.log</code> åšäº†ä¸€å±‚å°è£…ï¼ŒåŠ äº†ä¸€ä¸ª log è¾“å‡ºå‰ç¼€</p>
<h3 id="3-å‘å¸ƒé¡¹ç›®"><a href="#3-å‘å¸ƒé¡¹ç›®" class="headerlink" title="3. å‘å¸ƒé¡¹ç›®"></a>3. å‘å¸ƒé¡¹ç›®</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å‘å¸ƒè¿™ä¸ªé¡¹ç›®ï¼Œç‰ˆæœ¬å°±æ˜¯ä¸Šé¢çš„ <code>version: 1.0.0</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">\testlog&gt; npm publish --registry http://43.139.27.159:4873/</span><br><span class="line">npm notice</span><br><span class="line">npm notice ğŸ“¦  testlog@1.0.0</span><br><span class="line">npm notice === Tarball Contents ===</span><br><span class="line">npm notice 93B  index.js</span><br><span class="line">npm notice 214B package.json</span><br><span class="line">npm notice === Tarball Details ===</span><br><span class="line">npm notice name:          testlog</span><br><span class="line">npm notice version:       1.0.0</span><br><span class="line">npm notice filename:      testlog-1.0.0.tgz</span><br><span class="line">npm notice package size:  332 B</span><br><span class="line">npm notice unpacked size: 307 B</span><br><span class="line">npm notice shasum:        8e13c7124703cf5a6fe8d73dce54ef541f8edcb4</span><br><span class="line">npm notice integrity:     sha512-vUYCEp6/Lw7cj[...]vYziTPKdNFRBg==</span><br><span class="line">npm notice total files:   2</span><br><span class="line">npm notice</span><br><span class="line">npm notice Publishing to http://43.139.27.159:4873/</span><br><span class="line">+ testlog@1.0.0</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ—¶å€™å°±å¯ä»¥å† web åå°çœ‹åˆ°äº†:</p>
<p><img src="/2023/09/19/npm-verdaccio/3.png" alt="1"></p>
<p>å¯ä»¥çœ‹åˆ°é¦–é¡µåˆ—è¡¨ä¸­ï¼Œå·²ç»æœ‰ä¸€ä¸ªåŒ…äº†ï¼Œå¹¶ä¸”ä»–çš„æ ‡é¢˜å°±æ˜¯åŒ…å(package.json æ–‡ä»¶çš„ name å­—æ®µ), æè¿°å°±æ˜¯ package.json æ–‡ä»¶çš„ description å­—æ®µï¼Œ ç‰ˆæœ¬å°±æ˜¯ <code>1.0.0</code>, å› ä¸º author å­—æ®µæ˜¯ç©ºï¼Œæ‰€ä»¥ä½œè€…å˜æˆ <code>Unknown</code>.</p>
<blockquote>
<p>å¦‚æœæœ‰ README.md æ–‡ä»¶çš„è¯ï¼Œæè¿°ä¼šä¼˜å…ˆè·å– README.md æ–‡ä»¶ä¸­ä¸»æ ‡é¢˜ä¸‹çš„ç¬¬ä¸€è¡Œï¼Œå¦‚æœæ²¡æœ‰ README.md æ–‡ä»¶çš„è¯ï¼Œæè¿°æ‰ä¼šè·å– package.json æ–‡ä»¶çš„ description å­—æ®µ</p>
</blockquote>
<p>ç‚¹è¿›å»ä¼šå‘ç°æ²¡æœ‰è¯¦æƒ…ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ README.mdï¼Œ å³è¾¹çš„è¯¦æƒ…ä¹Ÿæ²¡æœ‰ author</p>
<p><img src="/2023/09/19/npm-verdaccio/4.png" alt="1"></p>
<p>æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å†è¿­ä»£ä¸€ä¸ªç‰ˆæœ¬ï¼Œå› ä¸ºæ˜¯ patch ç‰ˆæœ¬ï¼Œæ‰€ä»¥æ–°çš„ç‰ˆæœ¬å·æ˜¯ <code>1.0.1</code>ï¼Œ ç„¶åå¡«å†™äº† author è¿™ä¸€æ ï¼Œå¢åŠ äº† README æ–‡ä»¶ã€‚<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"testlog"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.1"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"is test log"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">"zach"</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å† publish ä¸€æ¬¡ï¼Œå¯ä»¥çœ‹åˆ°ç‰ˆæœ¬å·å˜æˆ <code>1.0.1</code> äº†ï¼Œ author ä¿¡æ¯æœ‰äº†ï¼Œ readme å†…å®¹ä¹Ÿæœ‰äº†</p>
<p><img src="/2023/09/19/npm-verdaccio/5.png" alt="1"></p>
<p>æ¯æ¬¡å‘å¸ƒçš„æ—¶å€™ï¼Œ version å­—æ®µéƒ½è¦å¾€ä¸ŠåŠ ï¼Œä¸èƒ½å¾€ä¸‹ï¼Œå¯ä»¥èµ°æœ€åä¸€ä½ä¿®è®¢å·(patch)ï¼Œä¹Ÿå¯ä»¥æ˜¯ç¬¬äºŒä½çš„æ¬¡ç‰ˆæœ¬å·(minor)ï¼Œæˆ–è€…ç¬¬ä¸€ä½çš„ä¸»ç‰ˆæœ¬å·(major)ï¼Œåæ­£å°±æ˜¯ä¸èƒ½å¾€ä¸‹ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚</p>
<h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><p>åŒæ—¶è¦æ³¨æ„ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨ publish çš„æ—¶å€™ï¼Œnpm é»˜è®¤ä¹Ÿä¼šæ’é™¤<a href="https://docs.npmjs.com/cli/v9/using-npm/developers#keeping-files-out-of-your-package" target="_blank" rel="noopener">ä¸€äº›æ–‡ä»¶</a>ï¼Œä¸ä¼šå°†ä»–ä»¬å‘å¸ƒåˆ°åŒ…ä¸­ã€‚ æ¯”å¦‚è¿‡æ»¤æ‰è¿™äº›:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.*.swp</span><br><span class="line">._*</span><br><span class="line">.DS_Store</span><br><span class="line">.git</span><br><span class="line">.gitignore</span><br><span class="line">.hg</span><br><span class="line">.npmignore</span><br><span class="line">.npmrc</span><br><span class="line">.lock-wscript</span><br><span class="line">.svn</span><br><span class="line">.wafpickle-*</span><br><span class="line">config.gypi</span><br><span class="line">CVS</span><br><span class="line">npm-debug.log</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä»–çš„å‰©ä½™æ–‡ä»¶éƒ½ä¼šå‘å¸ƒä¸Šå»ï¼Œå¦‚æœéœ€è¦æ’é™¤å…¶ä»–æ–‡ä»¶ï¼Œå¯ä»¥åœ¨<code>.npmignore</code>ä¸­é…ç½®ã€‚</p>
<p>åŒæ—¶å¦‚æœä½ çš„åŒ…æ˜¯éœ€è¦æ„å»ºçš„ï¼Œåªéœ€è¦å‘å¸ƒæ„å»ºåçš„æ–‡ä»¶ï¼Œ<code>src</code> ç›®å½•ä¸éœ€è¦ï¼Œé‚£ä¹ˆå°±è¦åœ¨ <code>package.json</code> æŒ‡å®š <code>files</code> å­—æ®µï¼Œå°†æ„å»ºåçš„ç›®å½•æˆ–è€…æ–‡ä»¶åŒ…å«åœ¨ <code>files</code> æ•°ç»„é‡Œé¢ï¼Œ è¿™æ ·å­ npm åœ¨ publish çš„æ—¶å€™ï¼Œå°±ä¼šé»˜è®¤åªå‘å¸ƒ <code>files</code> æ•°ç»„é‡Œé¢çš„æ–‡ä»¶ã€‚</p>
<blockquote>
<p><code>package.json</code>, <code>README.md</code>, <code>CHANGELOG.md</code>, <code>LICENCE</code> è¿™å‡ ä¸ªæ–‡ä»¶ä¸éœ€è¦ç‰¹æ„æŒ‡å®šåˆ° files æ•°ç»„ï¼Œä¹Ÿä¼šè‡ªåŠ¨åŒ…å«, é™¤éæ‰‹åŠ¨å¼ºåˆ¶åœ¨ <code>.npmignore</code> ä¸­é…ç½®ä¸è¦</p>
</blockquote>
<h3 id="4-æ’¤é”€å·²å‘å¸ƒçš„åŒ…"><a href="#4-æ’¤é”€å·²å‘å¸ƒçš„åŒ…" class="headerlink" title="4. æ’¤é”€å·²å‘å¸ƒçš„åŒ…"></a>4. æ’¤é”€å·²å‘å¸ƒçš„åŒ…</h3><p>æ’¤é”€å·²å‘å¸ƒçš„åŒ…åœ¨ Verdaccio ä¸­æ˜¯é€šè¿‡ä½¿ç”¨ npm unpublish å‘½ä»¤æ¥å®Œæˆçš„ï¼Œæ ¼å¼ä¸º:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm unpublish [@scope/]pkg[@version] --registry http://43.139.27.159:4873</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>@scope/</code> æ˜¯å¯é€‰çš„ï¼Œä»…åœ¨ä½ æ’¤é”€çš„åŒ…åœ¨ç‰¹å®šä½œç”¨åŸŸä¸‹æ—¶éœ€è¦ã€‚</li>
<li><code>pkg</code> æ˜¯ä½ è¦æ’¤é”€çš„åŒ…çš„åç§°ã€‚</li>
<li><code>@version</code> æ˜¯ä½ è¦æ’¤é”€çš„åŒ…çš„ç‰ˆæœ¬ã€‚å¦‚æœä½ æƒ³æ’¤é”€æ‰€æœ‰ç‰ˆæœ¬ï¼Œå¯ä»¥çœç•¥è¿™éƒ¨åˆ†ã€‚</li>
</ul>
<p>å¯¹äºæœ¬ä¾‹æ¥è¯´ï¼Œç”±äºåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰é’ˆå¯¹è¿™ä¸ªåŒ…è®¾å®šä½œç”¨åŸŸï¼Œå› æ­¤ä¸éœ€è¦å¡«ã€‚æƒ³æ’¤é”€åˆšæ‰å‘å¸ƒçš„ <code>1.0.1</code> ç‰ˆæœ¬, å°±å¯ä»¥:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\testlog&gt; npm unpublish testlog@1.0.1 --registry http://43.139.27.159:4873/</span><br><span class="line">- testlog@1.0.1</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ—¶å€™ web åå°å°±åªå‰©ä¸‹ 1.0.0 çš„ç‰ˆæœ¬äº†ã€‚ </p>
<p>å¦‚æœæƒ³æ•´ä¸ªåŒ…éƒ½æ’¤æ‰ï¼Œä¹Ÿå°±æ˜¯åˆ æ‰ï¼Œä¸å¸¦ç‰ˆæœ¬å·å°±è¡Œäº†ï¼Œä¸è¿‡è¦åŠ  <code>-f</code> æŒ‡ä»¤ï¼Œè¡¨ç¤ºå¼ºåˆ¶åˆ é™¤ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œä¼šæŠ¥é”™<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">\testlog&gt; npm unpublish testlog -f --registry http://43.139.27.159:4873/</span><br><span class="line">npm WARN using --force Recommended protections disabled.</span><br><span class="line">- testlog</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ—¶å€™æ•´ä¸ªåŒ…éƒ½è¢«åˆ æ‰äº†ï¼Œweb åå°çœ‹ä¸åˆ°è¿™ä¸ªåŒ…äº†</p>
<p><img src="/2023/09/19/npm-verdaccio/6.png" alt="1"></p>
<h3 id="5-å…³äº-scope-ä½œç”¨åŸŸ"><a href="#5-å…³äº-scope-ä½œç”¨åŸŸ" class="headerlink" title="5. å…³äº scope ä½œç”¨åŸŸ"></a>5. å…³äº scope ä½œç”¨åŸŸ</h3><p>é¦–å…ˆä¸ºå•¥ä¼šæœ‰ scope çš„éœ€æ±‚, å¾ˆç®€å•ï¼Œæ‰€æœ‰ npm åŒ…éƒ½æœ‰ä¸€ä¸ªåç§°ã€‚å¦‚æœä½ è¦ç»™è‡ªå·±çš„åŒ…ï¼Œèµ·ä¸€ä¸ªæœ‰ã€Œå¯“æ„ã€çš„åå­—ï¼Œä¼šå‘ç°ç»å¤§å¤šæ•°å•è¯/çŸ­è¯­å·²è¢«å ç”¨ï¼Œå³ä½¿æ²¡æœ‰çœŸæ­£çš„å†…å®¹ï¼Œè¿™çœŸæ˜¯æ— å¯å¥ˆä½•çš„äº‹å„¿ã€‚å¦‚ä½•è§£å†³è¿™ä¸€å›°å¢ƒå‘¢ï¼Ÿ ä½ å¯ä»¥å‘å¸ƒå¸¦ä½œç”¨åŸŸ/èŒƒå›´ï¼ˆscopeï¼‰çš„åŒ…ï¼Œé€šè¿‡ <code>scope + pkg</code> çš„å…¨åç§°æ¥è®©ä½ çš„åŒ…ä¸ä¼šé‡å¤ï¼Œå¹¶ä¸”ä¾¿äºç»„ç»‡è¯†åˆ«ã€‚</p>
<blockquote>
<p>äº‹å®ä¸Š npm ä¸Šé¢çš„ scope å…¶å®ä»£è¡¨çš„å°±æ˜¯ org ç»„ç»‡</p>
</blockquote>
<p>æ‰€ä»¥æ­£å¸¸æˆ‘ä»¬åœ¨ä½¿ç”¨ç§æœ‰åº“ lib çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯è‡ªå·±è‡ªç ”çš„ï¼Œé‚£ä¹ˆä¼šå¸¦ä¸Š scope, è¿™ä¸ªæ˜¯å› ä¸ºæˆ‘ä»¬çš„ç§æœ‰åº“çš„ libï¼Œä¸€èˆ¬åŒ…å« 3 ç§ç±»å‹çš„ lib:</p>
<ol>
<li>å›¢é˜Ÿå†…éƒ¨è‡ªç ”çš„ï¼Œè¿™æ—¶å€™ scope å°±ä¼šæ˜¯æˆ‘ä»¬è‡ªå·±å®šçš„ç»„ç»‡åç§°, æ¯”å¦‚ç»„ç»‡åç§°å« airï¼Œ é‚£ä¹ˆå†…éƒ¨è‡ªç ”çš„åº“ï¼Œéƒ½åº”è¯¥æ˜¯ä»¥ air è¿™ä¸ª scope å‘½åã€‚å½“ç„¶å¦‚æœä½ å†…éƒ¨è‡ªç ”çš„åº“å¾ˆå¤šï¼Œè¿˜å¯ä»¥å†ç»†åˆ†ï¼Œæ¯”å¦‚å¦‚æœæ˜¯ js åŠŸèƒ½çš„åº“ï¼Œé‚£ä¹ˆ scope å°±å¯ä»¥å« <code>air-js</code>, å¦‚æœæ˜¯ç»„ä»¶åº“çš„ï¼Œé‚£ä¹ˆ scope å°±å¯ä»¥å« <code>air-component</code></li>
<li>åŸºäºçº¿ä¸Šå¼€æºé¡¹ç›®å†è¿›è¡ŒäºŒå¼€è‡ªå·±ç»´æŠ¤çš„ï¼Œè¿™æ—¶å€™ scope å°±æ˜¯å¼€æºé¡¹ç›®çš„ scope</li>
<li>ä¹‹å‰çº¿ä¸Šæœ‰å¼€æºï¼Œæœ‰åœ°å€ï¼Œä½†æ˜¯åé¢ä¸å†ç»´æŠ¤ï¼Œæˆ–è€…æ˜¯å¾ˆæ—§çš„æ‰¾ä¸åˆ°çº¿ä¸ŠåŒ…çš„åº“ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±ä¼š fork ä¸€ä»½åˆ°ç§æœ‰åº“ï¼Œä½†æ˜¯ä¸è¿›è¡ŒäºŒå¼€éœ€æ±‚ï¼Œè¿™æ—¶å€™ scope å°±æ˜¯ fork</li>
</ol>
<p>å› ä¸ºåˆšæ‰çš„æµ‹è¯•é¡¹ç›®è¢« <code>unpublish</code> åˆ æ‰äº†, æ‰€ä»¥æˆ‘ä»¬é‡æ–°å†åˆ›å»ºä¸€ä¸ªå…·æœ‰ scope çš„é¡¹ç›®ï¼Œé€šè¿‡ <code>npm init --scope xxx</code> æ¥æŒ‡å®šé¡¹ç›®åˆå§‹åŒ–çš„ scope<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir testlog2</span><br><span class="line">$ cd testlog2/</span><br><span class="line">$ npm init --scope zachke -y</span><br><span class="line">Wrote to \testlog2\package.json:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;@zachke/testlog2&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;keywords&quot;: [],</span><br><span class="line">  &quot;author&quot;: &quot;&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ—¶å€™æˆ‘å°±å»ºäº†ä¸€ä¸ª scope ä¸º <code>zachke</code> çš„åŒ…äº†ï¼ŒåŒ…åä¸º <code>testlog2</code></p>
<h3 id="6-å®‰è£…ç§æœ‰åŒ…"><a href="#6-å®‰è£…ç§æœ‰åŒ…" class="headerlink" title="6. å®‰è£…ç§æœ‰åŒ…"></a>6. å®‰è£…ç§æœ‰åŒ…</h3><p>é‚£ä¹ˆæ€ä¹ˆåœ¨é¡¹ç›®ä¸­å®‰è£…å‘¢? æœ‰å‡ ç§æ–¹å¼ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå°±ä¸€ä¸ªç®€å•çš„ node é¡¹ç›®ï¼Œä¹Ÿä¸å¼•ç”¨ä»€ä¹ˆ vue æ¡†æ¶äº†:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir my-project</span><br><span class="line">$ cd my-project/</span><br><span class="line">$ npm init -y</span><br></pre></td></tr></table></figure></p>
<h4 id="1-å‘½ä»¤è¡Œç›´æ¥æŒ‡å®š-registry-å®‰è£…"><a href="#1-å‘½ä»¤è¡Œç›´æ¥æŒ‡å®š-registry-å®‰è£…" class="headerlink" title="1. å‘½ä»¤è¡Œç›´æ¥æŒ‡å®š registry å®‰è£…"></a>1. å‘½ä»¤è¡Œç›´æ¥æŒ‡å®š registry å®‰è£…</h4><p>æ¥ä¸‹æ¥ç›´æ¥å®‰è£…åˆšæ‰çš„é‚£ä¸ªåŒ…:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\my-project&gt; npm install @zachke/testlog2 --registry http://43.139.27.159:4873/</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ—¶å€™å°±å¯ä»¥å† <code>package.json</code> çœ‹åˆ°è¿™ä¸ªåŒ…çš„ä¾èµ–äº†</p>
<p><img src="/2023/09/19/npm-verdaccio/7.png" alt="1"></p>
<p>æ¥ä¸‹æ¥ç›´æ¥å¼•ç”¨è¿™ä¸ªåŒ…å°±å¯ä»¥äº†ã€‚ è¡¥ä¸Šé¡¹ç›®çš„ <code>index.js</code> å…¥å£æ–‡ä»¶:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const &#123; mylog &#125; = require(&apos;@zachke/testlog2&apos;);</span><br><span class="line"></span><br><span class="line">mylog(&quot;hello!!&quot;)</span><br></pre></td></tr></table></figure></p>
<p>å¹¶ä¸”è¡¥ä¸Š script è¿è¡ŒæŒ‡ä»¤ <code>node index.js</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;my-project&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;node index.js&quot;,</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;keywords&quot;: [],</span><br><span class="line">  &quot;author&quot;: &quot;&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;@zachke/testlog2&quot;: &quot;^1.0.0&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨ npm è¿è¡Œäº†:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">\my-project&gt; npm run start</span><br><span class="line"></span><br><span class="line">&gt; my-project@1.0.0 start</span><br><span class="line">&gt; node index.js</span><br><span class="line"></span><br><span class="line">mylog:  hello!!</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¡¹ç›®å·²ç»è¿è¡Œèµ·æ¥äº†ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„ç§æœ‰åŒ…æœ‰è¢«æˆåŠŸå¼•ç”¨ã€‚ ä¸è¿‡è¿™ç§æƒ…å†µçš„å®‰è£…æœ‰ä¸ªé—®é¢˜ï¼Œä»–æ˜¯ä¾èµ– lock æ–‡ä»¶ï¼Œå¦‚æœæ˜¯ npm å®‰è£…ï¼Œé‚£ä¹ˆå°±æ˜¯ä¾èµ– <code>package-lock.json</code> è¿™ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°ä¸­çš„</p>
<p><img src="/2023/09/19/npm-verdaccio/8.png" alt="1"></p>
<p>å¦‚æœæ˜¯ yarn å®‰è£…çš„ï¼Œé‚£ä¹ˆå°±æ˜¯ä¾èµ–äº yarn.lock æ–‡ä»¶ã€‚</p>
<p>è¿™ç§æ–¹å¼çš„å®‰è£…ç¼ºç‚¹å°±æ˜¯ä¸€æ—¦è¿™ä¸ª lock æ–‡ä»¶è¢«åˆ æ‰ï¼Œé‚£ä¹ˆå°±ä¸ä¼šä»ç§æœ‰æºå®‰è£…ã€‚å› ä¸ºå¤–éƒ¨å…¬å…± npmjs æ²¡æœ‰è¿™ä¸ªç§æœ‰åŒ…ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p>
<h4 id="2-ç§æœ‰åº“è®¾ç½®ä¸ºå…¨å±€çš„æº"><a href="#2-ç§æœ‰åº“è®¾ç½®ä¸ºå…¨å±€çš„æº" class="headerlink" title="2. ç§æœ‰åº“è®¾ç½®ä¸ºå…¨å±€çš„æº"></a>2. ç§æœ‰åº“è®¾ç½®ä¸ºå…¨å±€çš„æº</h4><p>ç¬¬äºŒç§å®‰è£…æ–¹å¼ï¼Œå°±æ˜¯å°†ä½ çš„ç§æœ‰åº“çš„æºè®¾ç½®ä¸ºå…¨å±€çš„æº<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry http://43.139.27.159:4873</span><br><span class="line"></span><br><span class="line">yarn config set registry http://43.139.27.159:4873</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å°±å¯ä»¥ä½¿ä½ çš„é¡¹ç›®ä¸­çš„æ‰€æœ‰åŒ…éƒ½ä»ç§æœ‰æºå®‰è£…ï¼ŒVerdaccio ä¼šè‡ªåŠ¨ä»£ç† npmjs.orgä¸Šçš„åŒ… (å¯ä»¥æŒ‡å®š uplink çš„å…¶ä»–ä»£ç†)ï¼Œå¹¶ä¸”ä¼šç¼“å­˜è¿™äº›åŒ…ä»¥åŠ å¿«å®‰è£…é€Ÿåº¦ï¼Œä½†æ˜¯å¯é æ€§æœªéªŒè¯ï¼Œæš‚æ—¶ä¸æ¨èã€‚</p>
<p>è€Œä¸”ä¸ºäº†å®‰å…¨ï¼Œå…¶å®æˆ‘æ˜¯æ¨èåœ¨ç§æœ‰åº“çš„é…ç½®ä¸­ï¼Œå°†ä¸Šæ¸¸çš„ npm çš„ä»£ç†é…ç½®å…³é—­çš„ï¼Œä¹Ÿå°±æ˜¯éç§æœ‰åº“çš„åŒ…ï¼Œä¸åº”è¯¥é€šè¿‡ç§æœ‰åº“åœ°å€å»å®‰è£…, ä¹Ÿå°±æ˜¯å°† packages ä¸­çš„å„ä¸ª scoped çš„é…ç½®ä¸‹é¢çš„ <code>proxy</code> é…ç½®åˆ æ‰æˆ–è€…æ³¨é‡Šæ‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">packages:</span><br><span class="line">  &apos;@*/*&apos;:</span><br><span class="line">    # scoped packages</span><br><span class="line">    access: $all</span><br><span class="line">    publish: $authenticated</span><br><span class="line">    unpublish: $authenticated</span><br><span class="line">    # æ—¢ç„¶æ˜¯ç§æœ‰åº“äº†ï¼Œæ‰¾ä¸åˆ°å°±éœ€è¦å»å…¬ç½‘æ‰¾ï¼Œè¿™æ ·å­æ›´å®‰å…¨</span><br><span class="line">    # proxy: npmjs</span><br></pre></td></tr></table></figure></p>
<p>ä¸€æ—¦å…³é—­äº† proxy åŠŸèƒ½ï¼Œè¿™æ—¶å€™å®‰è£…åŒ…å°±æ›´ä¸èƒ½èµ°å°†ç§æœ‰åº“è®¾ç½®ä¸ºå…¨å±€æºçš„æ–¹å¼äº†ï¼Œä¸ç„¶å°±ä¼šå‡ºç°è¯¥é¡¹ç›®å®‰è£…å…¶ä»–éç§æœ‰åº“çš„æ—¶å€™ï¼Œå°±ä¼šæ‰¾ä¸åˆ°æŠ¥é”™ã€‚</p>
<h4 id="3-é¡¹ç›®é…ç½®ä¸­æŒ‡å®šç‰¹å®šçš„registryä¸ºç‰¹å®šçš„scopeæä¾›åŒ…-æ¨è"><a href="#3-é¡¹ç›®é…ç½®ä¸­æŒ‡å®šç‰¹å®šçš„registryä¸ºç‰¹å®šçš„scopeæä¾›åŒ…-æ¨è" class="headerlink" title="3. é¡¹ç›®é…ç½®ä¸­æŒ‡å®šç‰¹å®šçš„registryä¸ºç‰¹å®šçš„scopeæä¾›åŒ… (æ¨è)"></a>3. é¡¹ç›®é…ç½®ä¸­æŒ‡å®šç‰¹å®šçš„registryä¸ºç‰¹å®šçš„scopeæä¾›åŒ… (æ¨è)</h4><p>æœ¬ä¾‹å°±æ˜¯åœ¨ my-project é¡¹ç›®ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª npm åŒ…é…ç½®æ–‡ä»¶ <code>.npmrc</code> ï¼Œæ¯”å¦‚æœ¬é¡¹ç›®å°±æ˜¯ <code>.npmrc</code>, ç„¶ååœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æŒ‡å®šç‰¹å®šåŒ…çš„ç‰¹å®šæºï¼Œæ¯”å¦‚æœ¬ä¾‹å°±æ˜¯</p>
<blockquote>
<p>å¦‚æœæ˜¯ yarn å®‰è£…çš„ï¼Œé‚£ä¹ˆå°±æ˜¯ <code>.yarnrc</code> æ–‡ä»¶</p>
</blockquote>
<p><img src="/2023/09/19/npm-verdaccio/9.png" alt="1"></p>
<p>è¿™è¾¹é… scope å°±å¯ä»¥äº†ï¼Œå®ƒä¼šå°†æ‰€æœ‰è¿™ä¸ª scope ä¸­çš„åŒ…ï¼Œå…¨éƒ¨æ¢æˆåé¢æŒ‡å®šçš„åœ°å€æ¥ä¸‹è½½ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ç§æœ‰åº“åœ°å€ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@zachke:registry=http://43.139.27.159:4873/</span><br></pre></td></tr></table></figure></p>
<p>scope å¦‚æœä¸å†™çš„è¯ï¼Œæ¯”å¦‚è¿™æ ·å­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">registry=http://43.139.27.159:4873/</span><br></pre></td></tr></table></figure></p>
<p>é‚£å…¶å®å°±æ˜¯å…¨å±€é…ç½®äº†ï¼Œæ˜¯åªé’ˆå¯¹è¿™ä¸ªé¡¹ç›®çš„å…¨å±€é…ç½®ï¼Œæœ¬è´¨ä¸Šè·Ÿç¬¬äºŒç§å…¨å±€æ”¹ registry çš„æ•ˆæœä¸€æ ·ã€‚ä¹Ÿä¸æ¨èï¼Œæ‰€ä»¥è¿˜æ˜¯è¦æœ‰ scope</p>
<p>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼Œå…ˆæŠŠåŸå…ˆçš„åŒ…åˆ æ‰ï¼Œç„¶åå†å®‰è£…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\my-project&gt; npm uninstall @zachke/testlog2 --registry http://43.139.27.159:4873/</span><br><span class="line">\my-project&gt; npm install @zachke/testlog2</span><br></pre></td></tr></table></figure></p>
<p>è€Œè¿™ä¸ªä¹Ÿæ˜¯æˆ‘ä»¬é¡¹ç›®ä¸­æœ€å¸¸ç”¨çš„å®‰è£…ç§æœ‰åº“åŒ…çš„æ–¹å¼ã€‚</p>
<h2 id="å‘å¸ƒæ“ä½œåŠ é’‰é’‰é€šçŸ¥"><a href="#å‘å¸ƒæ“ä½œåŠ é’‰é’‰é€šçŸ¥" class="headerlink" title="å‘å¸ƒæ“ä½œåŠ é’‰é’‰é€šçŸ¥"></a>å‘å¸ƒæ“ä½œåŠ é’‰é’‰é€šçŸ¥</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»™å‘å¸ƒè¡Œä¸ºçš„æ“ä½œï¼ŒåŠ ä¸Šé’‰é’‰é€šçŸ¥ï¼ŒVerdaccio æ˜¯æ”¯æŒ hook è§¦å‘çš„ï¼Œå…·ä½“çœ‹:</p>
<ul>
<li><a href="https://verdaccio.org/docs/notifications/" target="_blank" rel="noopener">verdaccio send Notifications</a></li>
<li><a href="https://open.dingtalk.com/document/robots/custom-robot-access" target="_blank" rel="noopener">è‡ªå®šä¹‰æœºå™¨äººæ¥å…¥</a></li>
</ul>
<p>ç„¶å config.yaml æ–‡ä»¶ä¸­çš„æœ€åé…ä¸Šï¼Œè¦è®°å¾—é‡å¯ docker å®¹å™¨ç”Ÿæ•ˆ (<code>docker restart verdaccio</code>)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># notify</span><br><span class="line">notify:</span><br><span class="line">  &apos;dingding&apos;:</span><br><span class="line">    method: POST</span><br><span class="line">    headers: [&#123; &apos;Content-Type&apos;: &apos;application/json&apos; &#125;]</span><br><span class="line">    endpoint: https://oapi.dingtalk.com/robot/send?access_token=0427285b76cebabe510d14c294dba6738dcb5991515368e7293f16f9f0ba47a6</span><br><span class="line">    content: &apos;&#123;&quot;msgtype&quot;:&quot;markdown&quot;,&quot;markdown&quot;:&#123;&quot;title&quot;:&quot;ã€&#123;&#123; name &#125;&#125;ã€‘ ç‰ˆæœ¬æ›´æ–°&quot;,&quot;text&quot;:&quot;&gt; æ–°çš„åŒ…ç‰ˆæœ¬æ›´æ–°!!!&lt;br&gt; **åŒ…å**: &#123;&#123; name &#125;&#125; &lt;br&gt; **ç‰ˆæœ¬**: &#123;&#123;publishedPackage&#125;&#125; &lt;br&gt; **å‘å¸ƒè€…**: &#123;&#123;publisher.name&#125;&#125; &lt;br&gt; **æŸ¥çœ‹è¯¦æƒ…**: [æŸ¥çœ‹é“¾æ¥](http://43.139.27.159:4873/-/web/detail/&#123;&#123; name &#125;&#125;)&quot;,&quot;at&quot;:&#123;&quot;isAtAll&quot;:false&#125;&#125;&#125;&apos;</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åé‡æ–°æ¨é€ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œè¿™æ—¶å€™å¯ä»¥çœ‹åˆ°æœ‰ log äº† (å¯ä»¥é€šè¿‡ <code>docker logs -f verdaccio</code> æŸ¥çœ‹ log):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">info --- auth/allow_action: access granted to: zachke</span><br><span class="line">info --- zachke is allowed publish for @zachke/testlog2</span><br><span class="line">http &lt;-- 200, user: zachke(125.77.202.250), req: &apos;PUT /@zachke%2ftestlog2&apos;, bytes: 1496/0</span><br><span class="line">info --- A notification has been shipped: &#123;&quot;msgtype&quot;:&quot;markdown&quot;,&quot;markdown&quot;:&#123;&quot;title&quot;:&quot;ã€@zachke/testlog2ã€‘ ç‰ˆæœ¬æ›´æ–°&quot;,&quot;text&quot;:&quot;&gt; æ–°çš„åŒ…ç‰ˆæœ¬æ›´æ–°!!!&lt;br&gt; **åŒ…å**: @zachke/testlog2 &lt;br&gt; **ç‰ˆæœ¬**: @zachke/testlog2@1.0.5 &lt;br&gt; **å‘å¸ƒè€…**: zachke &lt;br&gt; **æŸ¥çœ‹è¯¦æƒ…**: [æŸ¥çœ‹é“¾æ¥](http://43.139.27.159:4873/-/web/detail/@zachke/testlog2)&quot;,&quot;at&quot;:&#123;&quot;isAtAll&quot;:false&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ•ˆæœå°±æ˜¯é’‰é’‰å¯ä»¥æ”¶åˆ°æœºå™¨äººé€šçŸ¥äº†:</p>
<p><img src="/2023/09/19/npm-verdaccio/10.png" alt="1"></p>
<h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><h3 id="1-ä¿®æ”¹-web-ui"><a href="#1-ä¿®æ”¹-web-ui" class="headerlink" title="1. ä¿®æ”¹ web ui"></a>1. ä¿®æ”¹ web ui</h3><p>æ­£å¸¸æƒ…å†µï¼Œæˆ‘ä»¬ä¸å¤ªéœ€è¦ä¿®æ”¹ web ç•Œé¢ uiï¼Œä½†æ˜¯ä¸ºäº†æ›´å¥½çš„å®šåˆ¶åŒ–ï¼Œä¸€èˆ¬æˆ‘ä»¬åªéœ€è¦æ”¹å‡ ä¸ªå€¼ï¼Œæ¯”å¦‚ <code>title</code>ï¼Œ <code>logo</code>ï¼Œ <code>primary_color</code> è¿™ä¸‰ä¸ªå€¼å°±å¤Ÿäº†</p>
<p>æ¯”å¦‚æˆ‘åœ¨é…ç½®æ–‡ä»¶ config.yaml æ”¹æˆ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">web:</span><br><span class="line">  title: zachNpm</span><br><span class="line">  logo: https://kebingzao.com/images/avatar.png</span><br><span class="line">  primary_color: &apos;#67b7bf&apos;</span><br></pre></td></tr></table></figure></p>
<p>é‡å¯ä¸€ä¸‹ docker å®¹å™¨ï¼Œå°±å¯ä»¥çœ‹åˆ°ç”Ÿæ•ˆäº†</p>
<p><img src="/2023/09/19/npm-verdaccio/11.png" alt="1"></p>
<blockquote>
<p>å¦‚æœè¿˜æƒ³å†å½»åº•ä¸€ç‚¹çš„ï¼Œ<code>favicon</code> è¿˜æ˜¯å¯ä»¥è°ƒæ•´çš„ï¼Œç”šè‡³åŠ è½½çš„ js éƒ½å¯ä»¥æ¢ï¼Œä½†æ˜¯ä¸€èˆ¬æ²¡å•¥å¿…è¦</p>
</blockquote>
<h3 id="2-ä¸å¯ç”¨-package-çš„ä»£ç†åŠŸèƒ½"><a href="#2-ä¸å¯ç”¨-package-çš„ä»£ç†åŠŸèƒ½" class="headerlink" title="2. ä¸å¯ç”¨ package çš„ä»£ç†åŠŸèƒ½"></a>2. ä¸å¯ç”¨ package çš„ä»£ç†åŠŸèƒ½</h3><p>ä¸Šæ–‡å…¶å®æœ‰è¯´è¿‡ï¼Œå…¶å® Verdaccio æ˜¯æ”¯æŒéå¸¸çµæ´»çš„ä»£ç†ä¸‹è½½åŠŸèƒ½çš„ï¼Œæ¯”å¦‚æˆ‘å¯ä»¥åœ¨ unlinks æŒ‡å®šå¤šä¸ªä»£ç†æº:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">uplinks:</span><br><span class="line">  npmjs:</span><br><span class="line">    url: https://registry.npmjs.org/</span><br><span class="line">  server2:</span><br><span class="line">    url: http://mirror.local.net/</span><br><span class="line">    timeout: 100ms</span><br><span class="line">  server3:</span><br><span class="line">    url: http://mirror2.local.net:9000/</span><br><span class="line">  baduplink:</span><br><span class="line">    url: http://localhost:55666/</span><br></pre></td></tr></table></figure></p>
<p>ç„¶ååœ¨ package é…ç½®é‚£è¾¹é’ˆå¯¹ä¸åŒçš„ scope æ¥æŒ‡å®šä¸åŒçš„ proxy, ç”šè‡³åŒä¸€ä¸ª scope å¯ä»¥æŒ‡å®šå¤šä¸ªä¸‹è½½æº<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">packages:</span><br><span class="line">    &apos;my-company-*&apos;:</span><br><span class="line">        access: $all</span><br><span class="line">        publish: $authenticated</span><br><span class="line">        unpublish: $authenticated</span><br><span class="line">        proxy: server3 npmjs</span><br><span class="line">    &apos;@my-local-scope/*&apos;:</span><br><span class="line">        access: $all</span><br><span class="line">        publish: $authenticated</span><br><span class="line">        unpublish: $authenticated</span><br><span class="line">        proxy: server2</span><br><span class="line">    &apos;**&apos;:</span><br><span class="line">        access: $all</span><br><span class="line">        publish: $authenticated</span><br><span class="line">        unpublish: $authenticated</span><br><span class="line">        proxy: npmjs</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯ä¸ºäº†å®‰å…¨ï¼Œæˆ‘æ˜¯ä¸å»ºè®®åœ¨ç§æœ‰åº“çš„èµ„æºé‡Œé¢å†å»ä»£ç†ä¸‹è½½å…¬ç½‘çš„åŒ…çš„ï¼Œæ‰€ä»¥åº”è¯¥å°† proxy çš„é…ç½®å»æ‰ï¼Œç§æœ‰åº“å°±åªè´Ÿè´£ä¸‹è½½ç§æœ‰åº“é‡Œé¢çš„ç§æœ‰åŒ…å°±è¡Œäº†ã€‚</p>
<p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„ä¸€ç‚¹å°±æ˜¯ï¼Œä¸€æ—¦å…³é—­äº†ç§æœ‰åº“çš„ package ä»£ç†åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨æ¶‰åŠåˆ°å…¨å±€å®‰è£…(<code>-g</code>)çš„æ—¶å€™ï¼Œå°±è¦æ³¨æ„äº†ï¼Œå°±ä¼šå‡ºç°è¯¥åŒ…çš„ç¬¬ä¸‰æ–¹ä¾èµ–æ— æ³•å®‰è£…ã€‚</p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦åœ¨å®‰è£…ä¹‹å‰è®¾ç½®ç§æœ‰æºåœ°å€ ä¾‹å¦‚ï¼šå…¨å±€å®‰è£…<code>@zach-js-library</code> è¿™ä¸ª scope ä¸‹çš„åŒ…å…¨å±€ä¾èµ–ä¹‹å‰ï¼Œéœ€è¦è®¾ç½®scope <code>@zach-js-library</code> çš„æºåœ°å€ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è®¾ç½®ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set @zach-js-library:registry http://43.139.27.159:4873</span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥ï¼Œå†å®‰è£…åŒ…åˆ°å…¨å±€ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @zach-js-library/&lt;package-name&gt; -g</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å­å°±å¯ä»¥å®‰è£…å…¨å±€çš„ç§æœ‰åº“äº†ã€‚</p>
<h3 id="3-nginx-ä»£ç†-https"><a href="#3-nginx-ä»£ç†-https" class="headerlink" title="3. nginx ä»£ç† https"></a>3. nginx ä»£ç† https</h3><p>Verdaccio æ˜¯æ”¯æŒ tls çš„ https é…ç½®ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬è¿˜æ˜¯ç”¨ nginx æ¥ä»£ç† https è¯·æ±‚ï¼Œä¸€æ–¹é¢æ˜¯ä¾¿äºè¯ä¹¦çš„ç®¡ç†ï¼Œæ¯å¹´æ¢è¯ä¹¦çš„æ—¶å€™ï¼Œç»Ÿä¸€æ¢ nginx çš„è¯ä¹¦å°±å¤Ÿäº†ï¼Œå…¶ä»–æœåŠ¡çš„è¯ä¹¦ä¸éœ€è¦é¢å¤–å»æ¢ã€‚</p>
<p>å¦ä¸€æ–¹é¢ nginx å¯¹è¯ä¹¦é“¾å’Œæ”¯æŒå’Œæ ¡éªŒä¹Ÿæ˜¯éå¸¸æˆç†Ÿçš„ï¼Œä¸ç”¨æ‹…å¿ƒä¼šå› ä¸ºè¯ä¹¦é“¾çš„éªŒè¯é—®é¢˜ï¼Œå¯¼è‡´æŸäº›æƒ…å†µä¼šå‡ºç° ssl çš„é“¾æ¥é”™è¯¯ã€‚</p>
<p>æ‰€ä»¥åº”è¯¥è¿™æ ·å­é…ç½®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@test-server conf.d]# cat npm.foo.com.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    server_name npm.foo.com;</span><br><span class="line">    ssl_certificate             ssl/foo.com.crt;</span><br><span class="line">    ssl_certificate_key         ssl/foo.com.key;</span><br><span class="line">    ssl_session_timeout         5m;</span><br><span class="line">    ssl_protocols               TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;</span><br><span class="line">    </span><br><span class="line">    #å…¼å®¹ä½ç‰ˆæœ¬çš„TLSv1.0 1.1 ç‰ˆæœ¬åŠ å¯†</span><br><span class="line">    ssl_ciphers EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH:ECDHE-RSA-AES128-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA128:DHE-RSA-AES128-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA128:ECDHE-RSA-AES128-SHA384:ECDHE-RSA-AES128-SHA128:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA128:DHE-RSA-AES128-SHA128:DHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA384:AES128-GCM-SHA128:AES128-SHA128:AES128-SHA128:AES128-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4;</span><br><span class="line">    ssl_prefer_server_ciphers   on;</span><br><span class="line"></span><br><span class="line">    access_log /var/log/nginx/npm.foo.com.access.log;</span><br><span class="line">    error_log /var/log/nginx/npm.foo.com.error.log;</span><br><span class="line">    </span><br><span class="line">    location /&#123;</span><br><span class="line">         add_header Access-Control-Allow-Methods &apos;GET, POST, OPTIONS&apos;;</span><br><span class="line">         add_header Access-Control-Allow-Headers &apos;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&apos;;</span><br><span class="line">         if ($request_method = &apos;OPTIONS&apos;) &#123;</span><br><span class="line">             return 204;</span><br><span class="line">         &#125;</span><br><span class="line">         proxy_set_header    X-Real-IP $remote_addr;</span><br><span class="line">         proxy_set_header    Host $http_host;</span><br><span class="line">         proxy_set_header    X-Forwarded-Proto $scheme;</span><br><span class="line">         proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">         proxy_pass          http://127.0.0.1:4873/;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åŒæ—¶è¿™è¾¹è¿˜è¦æ³¨æ„ä¸€ä¸ªç»†èŠ‚ï¼Œå°±æ˜¯è¦å°† nginx post çš„é™åˆ¶è°ƒå¤§ä¸€ç‚¹ï¼Œåœ¨ nginx.conf é‚£è¾¹è°ƒæ•´ï¼Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client_max_body_size 10M;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>è°ƒæ•´è·Ÿ verdaccio çš„é»˜è®¤é…ç½®å€¼ä¸€æ ·å³å¯: <code>max_body_size: 10mb</code></p>
</blockquote>
<p>ä¸ç„¶å°±ä¼šå‡ºç°å‘å¸ƒçš„æ—¶å€™åŒ…è¿‡å¤§ï¼Œå‡ºç°æŠ¥é”™ 413 çš„æƒ…å†µã€‚</p>
<h3 id="4-éµå¾ªç‰ˆæœ¬å·è¯­ä¹‰åŒ–"><a href="#4-éµå¾ªç‰ˆæœ¬å·è¯­ä¹‰åŒ–" class="headerlink" title="4. éµå¾ªç‰ˆæœ¬å·è¯­ä¹‰åŒ–"></a>4. éµå¾ªç‰ˆæœ¬å·è¯­ä¹‰åŒ–</h3><p>åœ¨å‘å¸ƒç‰ˆæœ¬çš„æ—¶å€™ï¼Œç‰ˆæœ¬å·ä¸€å®šè¦éµå¾ªè¯­ä¹‰åŒ–çš„è§„åˆ™ï¼Œå…·ä½“çœ‹: <a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noopener">è¯­ä¹‰åŒ–ç‰ˆæœ¬ 2.0.0</a></p>
<p>ç‰ˆæœ¬æ ¼å¼åˆ†ä¸ºä¸‰ä¸ªæ ¼å¼: ç‰ˆæœ¬æ ¼å¼ï¼š<code>ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·</code>(<code>MAJOR.MINOR.PATCH</code>)ï¼Œç‰ˆæœ¬å·é€’å¢è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸»ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†ä¸å…¼å®¹çš„ API ä¿®æ”¹ï¼Œ</li>
<li>æ¬¡ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢ï¼Œ</li>
<li>ä¿®è®¢å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£ã€‚</li>
</ul>
<p>å…ˆè¡Œç‰ˆæœ¬å·åŠç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯å¯ä»¥åŠ åˆ°â€œä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·â€çš„åé¢ï¼Œä½œä¸ºå»¶ä¼¸ã€‚</p>
<p>åŸºæœ¬ä¸Šçš„ç”¨æ³•:</p>
<table>
<thead>
<tr>
<th>åŒ…è¿­ä»£çŠ¶æ€</th>
<th>é˜¶æ®µ(Stage)</th>
<th>ç‰ˆæœ¬å·æ›´æ–°è§„åˆ™</th>
<th>èŒƒä¾‹</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç¬¬ä¸€æ¬¡å‘å¸ƒ</td>
<td>New product</td>
<td>ä» 1.0.0 å¼€å§‹</td>
<td>1.0.0</td>
<td>ç¬¬ä¸€æ¬¡å‘å¸ƒä¸Šä¼ åŒ…</td>
</tr>
<tr>
<td>bug ä¿®æ”¹å¹¶ä¸”å‘ä¸‹å…¼å®¹</td>
<td>Patch release</td>
<td>å¢åŠ ä¿®è®¢å·(patch)</td>
<td>1.0.1</td>
<td>bug å°ä¿®å¤</td>
</tr>
<tr>
<td>æ–°åŠŸèƒ½å¢åŠ å¹¶ä¸”å‘ä¸‹å…¼å®¹</td>
<td>Minor release</td>
<td>å¢åŠ æ¬¡ç‰ˆæœ¬å·(Minor),å¹¶ä¸”å°†ä¿®è®¢å·é‡ç½®ä¸º 0</td>
<td>1.1.0</td>
<td>æ–°çš„åŠŸèƒ½å‡ºç°ï¼Œå¹¶ä¸”ä¸å½±å“ç°æœ‰æ—§ç‰ˆæœ¬åº”ç”¨</td>
</tr>
<tr>
<td>å¯èƒ½ä¼šæœ‰æ— æ³•å‘ä¸‹å…¼å®¹</td>
<td>Major release</td>
<td>å¢åŠ ä¸»ç‰ˆæœ¬å·(Major)å¹¶ä¸”åé¢çš„æ¬¡ç‰ˆæœ¬å·å’Œä¿®è®¢å·éƒ½é‡ç½®ä¸º 0</td>
<td>2.0.0</td>
<td>ä¼šæœ‰ç ´ç¯æ€§æ›´æ–°ï¼Œæ—§ç‰ˆæœ¬å†ä¸è°ƒæ•´ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½æ— æ³•åº”ç”¨</td>
</tr>
</tbody>
</table>
<p>é™¤äº†å¯ä»¥ç›´æ¥åœ¨ <code>package.json</code> ç›´æ¥ä¿®æ”¹ç‰ˆæœ¬å·ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>npm version xxx</code> çš„æ–¹å¼æ¥æ›´æ–°ç‰ˆæœ¬å·<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm version [&lt;newversion&gt; | major | minor | patch | premajor | preminor | prepatch | prerelease | from-git]</span><br></pre></td></tr></table></figure></p>
<p>æ¯”å¦‚: åŸä¾†æ˜¯ <code>1.0.0</code>ï¼Œç”¨ <code>npm version minor</code> å°±ä¼šå˜æˆ <code>1.1.0</code>ï¼Œ åé¢ä½¿ç”¨åŒ…çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ <code>npm upgrade &lt;package&gt;</code> æ›´æ–°åŒ…ç‰ˆæœ¬</p>
<p>ç„¶ååœ¨å®‰è£…åŒ…çš„æ—¶å€™ï¼Œä¹Ÿæœ‰ä¸€äº›ç¬¦å·æˆ–è€…è¡¨è¾¾å¼æ¥ä¿è¯ï¼Œä½ åœ¨æ›´æ–°çš„æ—¶å€™ï¼Œä¸ä¼šä¸€ä¸‹å­è·¨å¤§ç‰ˆæœ¬æ›´æ–°ï¼Œæ¯”å¦‚</p>
<ul>
<li><code>~</code> â€“&gt; åªå…è®¸ä¿®è®¢å·ç‰ˆæœ¬è¿­ä»£(å¦‚æœæœ‰ç¼ºçœå€¼ï¼Œç¼ºçœéƒ¨åˆ†ä»»æ„è¿­ä»£)ï¼Œæ¯”å¦‚ <code>~1.2.3</code> ç›¸å½“äº <code>&gt;=1.2.3 &lt;1.3.0</code>, <code>~1.2</code> ç›¸å½“äº <code>&gt;=1.2.0 &lt; 1.3.0</code></li>
<li><code>^</code> â€“&gt; å…è®¸æ¬¡ç‰ˆæœ¬å·è¿­ä»£ï¼Œæ¯”å¦‚ <code>^1.2.3</code> ç›¸å½“äº <code>&gt;=1.2.3 &lt;2.0.0</code>, <code>^1.x</code> ç›¸å½“äº<code>&gt;=1.0.0 &lt;2.0.0</code></li>
<li><code>&lt;ã€&lt;=ã€&gt;ã€&gt;=ã€=</code> â€“&gt; æŒ‡å®šç‰ˆæœ¬èŒƒå›´ï¼Œæ¯”å¦‚ <code>=1.2.7 &lt;1.3.0</code> ä¸­åŒ…æ‹¬<code>1.2.7</code>ã€<code>1.2.8</code>ã€<code>1.2.99</code>ç­‰ç­‰ï¼Œä½†ä¸åŒ…æ‹¬<code>1.2.6</code>ã€<code>1.3.0</code> æˆ–<code>1.1.0</code>ç­‰ç­‰</li>
<li><code>xã€Xã€*</code> â€“&gt; å¯ä»¥æ›¿ä»£<code>ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·</code>ä¸‰æ®µä¸­ä»»æ„ä¸€æ®µï¼Œè¡¨ç¤ºè¯¥ä½ç½®ç‰ˆæœ¬å·æ²¡æœ‰é™åˆ¶, <code>*</code> ç›¸å½“äº <code>&gt;=0.0.0</code>ï¼Œè¡¨ç¤ºä»»ä½•ç‰ˆæœ¬å·, <code>1.X</code>æˆ–<code>1.x</code> ç›¸å½“äº <code>&gt;=1.0.0 &lt;2.0.0</code>ï¼ŒåŒ¹é…åˆ°ä¸»ç‰ˆæœ¬å·</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä½¿ç”¨ verdaccio æ­å»ºç§æœ‰ npm ä»“åº“ï¼Œå¯ä»¥è®©å‰ç«¯çš„å†…éƒ¨ç§æœ‰åŒ…å¾—åˆ°è§„èŒƒçš„å¼€å‘å’Œæµé€šï¼Œå¤§å¤§æä¾›äº†å‰ç«¯å¼€å‘çš„æ•ˆç‡ã€‚</p>
<p>æ¥ä¸‹æ¥è¯´ä¸€ä¸‹å›¢é˜Ÿåä½œä¸Šçš„ç§æœ‰åŒ…çš„å¼€å‘å’Œå‘å¸ƒè§„èŒƒ: <a href="/2023/09/21/npm-publish/" title="npm ç§æœ‰åº“å¼€å‘å’Œå‘å¸ƒè§„èŒƒ">npm ç§æœ‰åº“å¼€å‘å’Œå‘å¸ƒè§„èŒƒ</a></p>
<hr>
<p>å‚è€ƒèµ„æ–™:</p>
<ul>
<li><a href="https://verdaccio.org/docs/what-is-verdaccio" target="_blank" rel="noopener">What is Verdaccio?</a></li>
<li><a href="https://www.cnblogs.com/skylor/p/9675646.html" target="_blank" rel="noopener">NPM Version Management Specification</a></li>
<li><a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noopener">è¯­ä¹‰åŒ–ç‰ˆæœ¬ 2.0.0</a></li>
</ul>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š</strong>
    Zach Ke
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="http://kebingzao.com/2023/09/19/npm-verdaccio/" title="ä½¿ç”¨ verdaccio æ­å»ºå‰ç«¯å†…éƒ¨ç§æœ‰ npm ä»“åº“">http://kebingzao.com/2023/09/19/npm-verdaccio/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>
    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/npm/" rel="tag"># npm</a>
          
            <a href="/tags/verdaccio/" rel="tag"># verdaccio</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2023/08/25/vernemq-ssl-err/" rel="next" title="è®°ä¸€æ¬¡å¤§é™†åœ°åŒº VerneMQ å‡ºç°éƒ¨åˆ†è¯ä¹¦æ ¡éªŒå¤±è´¥çš„æƒ…å†µ">
                <i class="fa fa-chevron-left"></i> è®°ä¸€æ¬¡å¤§é™†åœ°åŒº VerneMQ å‡ºç°éƒ¨åˆ†è¯ä¹¦æ ¡éªŒå¤±è´¥çš„æƒ…å†µ
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2023/09/21/npm-publish/" rel="prev" title="npm ç§æœ‰åº“å¼€å‘å’Œå‘å¸ƒè§„èŒƒ">
                npm ç§æœ‰åº“å¼€å‘å’Œå‘å¸ƒè§„èŒƒ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="Zach Ke" />
            
              <p class="site-author-name" itemprop="name">Zach Ke</p>
              <p class="site-description motion-element" itemprop="description">åšæœ€å’¸çš„é‚£ä¸€æ¡</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">316</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">83</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/kebingzao" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å‰è¨€"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#verdaccio-ç®€ä»‹"><span class="nav-number">2.</span> <span class="nav-text">verdaccio ç®€ä»‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®‰è£…"><span class="nav-number">3.</span> <span class="nav-text">å®‰è£…</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å®‰è£…-docker"><span class="nav-number">3.1.</span> <span class="nav-text">å®‰è£… docker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å®‰è£…é•œåƒ"><span class="nav-number">3.2.</span> <span class="nav-text">å®‰è£…é•œåƒ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é…ç½®æ–‡ä»¶åˆ†æ"><span class="nav-number">4.</span> <span class="nav-text">é…ç½®æ–‡ä»¶åˆ†æ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®é™…æ“ä½œ"><span class="nav-number">5.</span> <span class="nav-text">å®é™…æ“ä½œ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-åˆ›å»ºè´¦å·"><span class="nav-number">5.1.</span> <span class="nav-text">1. åˆ›å»ºè´¦å·</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-åˆ›å»ºé¡¹ç›®"><span class="nav-number">5.2.</span> <span class="nav-text">2. åˆ›å»ºé¡¹ç›®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-å‘å¸ƒé¡¹ç›®"><span class="nav-number">5.3.</span> <span class="nav-text">3. å‘å¸ƒé¡¹ç›®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#æ³¨æ„äº‹é¡¹"><span class="nav-number">5.3.1.</span> <span class="nav-text">æ³¨æ„äº‹é¡¹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-æ’¤é”€å·²å‘å¸ƒçš„åŒ…"><span class="nav-number">5.4.</span> <span class="nav-text">4. æ’¤é”€å·²å‘å¸ƒçš„åŒ…</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-å…³äº-scope-ä½œç”¨åŸŸ"><span class="nav-number">5.5.</span> <span class="nav-text">5. å…³äº scope ä½œç”¨åŸŸ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-å®‰è£…ç§æœ‰åŒ…"><span class="nav-number">5.6.</span> <span class="nav-text">6. å®‰è£…ç§æœ‰åŒ…</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-å‘½ä»¤è¡Œç›´æ¥æŒ‡å®š-registry-å®‰è£…"><span class="nav-number">5.6.1.</span> <span class="nav-text">1. å‘½ä»¤è¡Œç›´æ¥æŒ‡å®š registry å®‰è£…</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-ç§æœ‰åº“è®¾ç½®ä¸ºå…¨å±€çš„æº"><span class="nav-number">5.6.2.</span> <span class="nav-text">2. ç§æœ‰åº“è®¾ç½®ä¸ºå…¨å±€çš„æº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-é¡¹ç›®é…ç½®ä¸­æŒ‡å®šç‰¹å®šçš„registryä¸ºç‰¹å®šçš„scopeæä¾›åŒ…-æ¨è"><span class="nav-number">5.6.3.</span> <span class="nav-text">3. é¡¹ç›®é…ç½®ä¸­æŒ‡å®šç‰¹å®šçš„registryä¸ºç‰¹å®šçš„scopeæä¾›åŒ… (æ¨è)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‘å¸ƒæ“ä½œåŠ é’‰é’‰é€šçŸ¥"><span class="nav-number">6.</span> <span class="nav-text">å‘å¸ƒæ“ä½œåŠ é’‰é’‰é€šçŸ¥</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ€ä½³å®è·µ"><span class="nav-number">7.</span> <span class="nav-text">æœ€ä½³å®è·µ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-ä¿®æ”¹-web-ui"><span class="nav-number">7.1.</span> <span class="nav-text">1. ä¿®æ”¹ web ui</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-ä¸å¯ç”¨-package-çš„ä»£ç†åŠŸèƒ½"><span class="nav-number">7.2.</span> <span class="nav-text">2. ä¸å¯ç”¨ package çš„ä»£ç†åŠŸèƒ½</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-nginx-ä»£ç†-https"><span class="nav-number">7.3.</span> <span class="nav-text">3. nginx ä»£ç† https</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-éµå¾ªç‰ˆæœ¬å·è¯­ä¹‰åŒ–"><span class="nav-number">7.4.</span> <span class="nav-text">4. éµå¾ªç‰ˆæœ¬å·è¯­ä¹‰åŒ–</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">8.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zach Ke</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://zach-2.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://kebingzao.com/2023/09/19/npm-verdaccio/';
          this.page.identifier = '2023/09/19/npm-verdaccio/';
          this.page.title = 'ä½¿ç”¨ verdaccio æ­å»ºå‰ç«¯å†…éƒ¨ç§æœ‰ npm ä»“åº“';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://zach-2.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("HIV4XRdKJXB0eaFgtSjiVNaK-gzGzoHsz", "zN3v8grxW0Q8eXwNlEgXxWrF");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  



</body>
</html>
